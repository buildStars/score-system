# 📋 多实例部署 - 文件清单

本指南包含在同一服务器上部署多套独立系统实例所需的所有文件和脚本。

---

## 📁 新增文件列表

### 核心脚本

1. **`create-instance.sh`** - 自动创建新实例脚本 ⭐
   - 功能：一键创建新实例，自动配置所有参数
   - 用法：`./create-instance.sh instance2 "客户A系统"`
   - 特点：全自动化，无需手动配置

2. **`manage-instances.sh`** - 批量实例管理脚本 ⭐
   - 功能：管理所有实例的启动、停止、日志、备份等
   - 用法：`./manage-instances.sh <命令> [参数]`
   - 支持命令：list, status, logs, restart, stop, start, update, backup

### 配置文件

3. **`env.example`** - 环境变量配置模板
   - 说明：包含所有环境变量的详细注释
   - 用途：手动部署时参考

### 文档

4. **`多实例快速开始.md`** - 快速入门指南 📖
   - 适合：想快速创建新实例的用户
   - 内容：一分钟快速上手教程

5. **`多实例部署指南.md`** - 完整部署指南 📖
   - 适合：需要深入了解的用户
   - 内容：架构说明、手动部署、高级配置

6. **`📋 多实例部署文件清单.md`** - 本文件
   - 说明：文件清单和使用说明

---

## 🚀 使用流程

### 第一次使用（新手推荐）

```bash
# 步骤 1: 进入项目目录
cd /root/score-system

# 步骤 2: 赋予执行权限
chmod +x create-instance.sh manage-instances.sh

# 步骤 3: 创建新实例
./create-instance.sh instance2 "客户A系统"

# 步骤 4: 等待完成，按提示访问
# 会自动显示访问地址，例如：
# - H5用户端: http://your-server:5175
# - 管理后台: http://your-server:5176
```

### 日常管理

```bash
# 查看所有实例
./manage-instances.sh list

# 查看运行状态
./manage-instances.sh status

# 查看某个实例的日志
./manage-instances.sh logs instance2

# 重启某个实例
./manage-instances.sh restart instance2

# 备份所有实例
./manage-instances.sh backup-all
```

---

## 📚 文档导航

### 我应该看哪个文档？

```
想快速上手？
  ↓
  阅读《多实例快速开始.md》
  ↓
  运行 ./create-instance.sh
  ↓
  完成！

需要了解原理？
  ↓
  阅读《多实例部署指南.md》
  ↓
  了解架构和配置
  ↓
  手动部署或自定义

遇到问题？
  ↓
  查看《多实例部署指南.md》的"常见问题"章节
  ↓
  查看主 README.md 的"常见问题"
  ↓
  联系技术支持
```

---

## 🎯 典型场景示例

### 场景1: 为新客户快速部署

```bash
# 1. 创建实例
./create-instance.sh client_abc "ABC公司系统"

# 2. 查看访问信息
./create-instance.sh info client_abc

# 3. 发送给客户
```

**预计时间**: 2-3分钟

---

### 场景2: 搭建测试环境

```bash
# 创建测试实例
./create-instance.sh test "测试环境"

# 测试完成后删除
cd /root/score-system-test
docker-compose down -v
cd /root
rm -rf score-system-test
```

**预计时间**: 创建2分钟，删除30秒

---

### 场景3: 批量更新所有实例

```bash
# 一键更新所有实例到最新版本
./manage-instances.sh update-all
```

**预计时间**: 每个实例约3-5分钟

---

### 场景4: 定期备份

```bash
# 手动备份所有实例
./manage-instances.sh backup-all

# 或设置自动备份（每天凌晨2点）
echo "0 2 * * * cd /root/score-system && ./manage-instances.sh backup-all" | crontab -
```

**备份位置**: `/root/backups/`

---

## ⚠️ 重要提示

### 端口规划

- 每个实例需要 5 个端口
- 建议预留端口范围：3000-3100（Backend）, 5173-5300（前端）
- 确保防火墙开放相应端口

### 资源监控

```bash
# 查看资源占用
./manage-instances.sh status

# 如果内存不足，考虑：
# 1. 限制容器资源
# 2. 增加 Swap
# 3. 升级服务器配置
```

### 安全建议

1. **修改默认密码**：每个实例的 .env 文件中的密码都不同
2. **定期备份**：至少每天备份一次
3. **防火墙配置**：只开放必要的端口
4. **监控告警**：建议配置监控系统

---

## 🔗 相关文件位置

```
score-system/
├── create-instance.sh           # ⭐ 创建实例脚本
├── manage-instances.sh          # ⭐ 管理实例脚本
├── env.example                  # 环境变量模板
├── docker-compose.yml           # Docker配置（被复制）
│
├── 多实例快速开始.md             # 📖 快速入门
├── 多实例部署指南.md             # 📖 完整指南
├── 📋 多实例部署文件清单.md      # 📖 本文件
│
└── README.md                    # 主文档（已更新）
```

---

## 💡 提示和技巧

### 查看实例信息

```bash
# 方法1: 使用脚本
./create-instance.sh info instance2

# 方法2: 查看配置文件
cat /root/score-system-instance2/.env
```

### 连接实例数据库

```bash
# 进入实例目录
cd /root/score-system-instance2

# 查看数据库密码
source .env
echo "端口: $MYSQL_PORT"
echo "用户: $MYSQL_USER"
echo "密码: $MYSQL_PASSWORD"

# 连接数据库
mysql -h 127.0.0.1 -P $MYSQL_PORT -u $MYSQL_USER -p
```

### 快速定位问题

```bash
# 1. 先看容器是否运行
docker ps | grep instance2

# 2. 查看容器日志
./manage-instances.sh logs instance2 backend

# 3. 检查端口是否被占用
netstat -tlnp | grep 3001

# 4. 进入容器调试
docker exec -it score-instance2-backend sh
```

---

## 📞 获取帮助

### 命令帮助

```bash
# 查看创建脚本帮助
./create-instance.sh

# 查看管理脚本帮助
./manage-instances.sh
```

### 文档索引

- **快速开始**: `多实例快速开始.md`
- **详细配置**: `多实例部署指南.md`
- **主文档**: `README.md`
- **后端文档**: `backend/README.md`
- **前端文档**: `frontend-h5/README.md`, `frontend-admin/README.md`

---

## ✅ 检查清单

部署新实例前：
- [ ] 服务器资源充足（CPU、内存、磁盘）
- [ ] 端口未被占用
- [ ] Docker 服务正常运行
- [ ] 有足够的磁盘空间（至少 10GB）

部署完成后：
- [ ] 容器全部正常运行
- [ ] 可以访问 H5 和管理后台
- [ ] API 文档可以打开
- [ ] 默认管理员账号可以登录
- [ ] 已修改默认密码
- [ ] 已设置定期备份

---

**祝您使用愉快！** 🎉

如有问题，请参考相关文档或联系技术支持。

---

**文档版本**: v1.0  
**最后更新**: 2025-11-30  
**维护者**: AI Assistant

