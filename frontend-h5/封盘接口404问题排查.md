# ğŸ› å°ç›˜æ¥å£404é—®é¢˜æ’æŸ¥

## âŒ é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**ï¼š
```json
{
  "code": 404,
  "message": "Cannot GET /api/lottery/status",
  "timestamp": "2025-11-26T20:35:37.804Z",
  "path": "/api/lottery/status"
}
```

**é—®é¢˜**ï¼šå‰ç«¯è°ƒç”¨ `/api/lottery/status` æ¥å£æ—¶è¿”å›404é”™è¯¯

---

## ğŸ” é—®é¢˜æ’æŸ¥

### 1. æ£€æŸ¥åç«¯è·¯ç”±å®šä¹‰ âœ…

**æ–‡ä»¶**ï¼š`backend/src/modules/lottery/lottery.controller.ts`

è·¯ç”±å®šä¹‰**æ­£ç¡®**ï¼š
```typescript
@Controller('lottery')
export class LotteryController {
  constructor(
    private readonly countdownService: LotteryCountdownService,
  ) {}

  @Get('status')  // âœ… è·¯ç”±å·²å®šä¹‰
  @ApiOperation({ summary: 'è·å–å½©ç¥¨çŠ¶æ€ï¼ˆå€’è®¡æ—¶ã€å°ç›˜çŠ¶æ€ç­‰ï¼‰' })
  async getLotteryStatus() {
    return this.countdownService.getLotteryStatus();
  }
}
```

å®Œæ•´è·¯å¾„åº”è¯¥æ˜¯ï¼š`/api/lottery/status` âœ…

---

### 2. æ£€æŸ¥æ¨¡å—é…ç½® âœ…

**æ–‡ä»¶**ï¼š`backend/src/modules/lottery/lottery.module.ts`

æ¨¡å—é…ç½®**æ­£ç¡®**ï¼š
```typescript
@Module({
  imports: [HttpModule],
  controllers: [LotteryController],  // âœ… Controllerå·²æ³¨å†Œ
  providers: [LotteryService, LotteryCountdownService],  // âœ… Serviceå·²æ³¨å†Œ
  exports: [LotteryService, LotteryCountdownService],
})
export class LotteryModule {}
```

---

### 3. å¯èƒ½çš„åŸå› 

#### åŸå› 1ï¼šåç«¯æœåŠ¡æœªé‡å¯ âš ï¸
**é—®é¢˜**ï¼šæ·»åŠ æ–°è·¯ç”±åï¼Œåç«¯éœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# åœæ­¢åç«¯æœåŠ¡ï¼ˆCtrl+Cï¼‰
# é‡æ–°å¯åŠ¨
cd score-system/backend
npm run start:dev
```

#### åŸå› 2ï¼šLotteryModuleæœªåœ¨AppModuleä¸­å¯¼å…¥ âš ï¸
**é—®é¢˜**ï¼š`LotteryModule` å¯èƒ½æ²¡æœ‰åœ¨ `app.module.ts` ä¸­å¯¼å…¥

**æ£€æŸ¥**ï¼š`backend/src/app.module.ts`
```typescript
@Module({
  imports: [
    // ...
    LotteryModule,  // âœ… åº”è¯¥åŒ…å«è¿™ä¸ª
    // ...
  ],
})
export class AppModule {}
```

#### åŸå› 3ï¼šè·¯ç”±å®ˆå«é—®é¢˜ âš ï¸
**é—®é¢˜**ï¼šå¯èƒ½æœ‰å…¨å±€å®ˆå«æ‹¦æˆªäº†è¯·æ±‚

**æ£€æŸ¥**ï¼š
- Controllerä¸Šæ˜¯å¦æœ‰ `@UseGuards()` è£…é¥°å™¨
- æ˜¯å¦éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®

**å½“å‰çŠ¶æ€**ï¼š
- `@Get('status')` æ²¡æœ‰å®ˆå« âœ…
- ä½†Controllerä¸Šæœ‰ `@ApiBearerAuth()` âš ï¸

#### åŸå› 4ï¼šç«¯å£æˆ–ä»£ç†é…ç½®é”™è¯¯ âš ï¸
**é—®é¢˜**ï¼šå‰ç«¯ä»£ç†é…ç½®å¯èƒ½ä¸æ­£ç¡®

**æ£€æŸ¥å‰ç«¯é…ç½®**ï¼š
- `vite.config.ts` ä¸­çš„ä»£ç†é…ç½®
- `src/api/request.ts` ä¸­çš„ baseURL

---

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šé‡å¯åç«¯æœåŠ¡ï¼ˆæ¨èï¼‰

```bash
# 1. åœæ­¢å½“å‰åç«¯æœåŠ¡
æŒ‰ Ctrl+C

# 2. é‡æ–°å¯åŠ¨åç«¯
cd D:\download\yunce\yunce\score-system\backend
npm run start:dev

# 3. ç­‰å¾…å¯åŠ¨æˆåŠŸ
# çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯è¯´æ˜å¯åŠ¨æˆåŠŸï¼š
# ğŸš€ åº”ç”¨å¯åŠ¨æˆåŠŸï¼
# ğŸ“¡ APIåœ°å€: http://localhost:3000/api
```

### æ–¹æ¡ˆ2ï¼šç§»é™¤è®¤è¯è£…é¥°å™¨

**é—®é¢˜**ï¼šControllerä¸Šæœ‰ `@ApiBearerAuth()` å¯èƒ½éœ€è¦è®¤è¯

**è§£å†³**ï¼šä¸º `status` å’Œ `can-bet` æ¥å£æ·»åŠ å…¬å¼€è®¿é—®æƒé™

**ä¿®æ”¹æ–‡ä»¶**ï¼š`backend/src/modules/lottery/lottery.controller.ts`

```typescript
import { Controller, Get, Post, Query, Body, UseGuards } from '@nestjs/common';
import { ApiTags, ApiOperation, ApiResponse, ApiBearerAuth } from '@nestjs/swagger';
import { Public } from '../../common/decorators/public.decorator';  // å¦‚æœæœ‰çš„è¯

@ApiTags('å¼€å¥–')
@ApiBearerAuth()
@Controller('lottery')
export class LotteryController {
  // ...

  @Get('status')
  @Public()  // æ·»åŠ è¿™ä¸ªè£…é¥°å™¨ï¼Œå…è®¸å…¬å¼€è®¿é—®
  @ApiOperation({ summary: 'è·å–å½©ç¥¨çŠ¶æ€ï¼ˆå€’è®¡æ—¶ã€å°ç›˜çŠ¶æ€ç­‰ï¼‰' })
  @ApiResponse({ status: 200, description: 'è·å–æˆåŠŸ' })
  async getLotteryStatus() {
    return this.countdownService.getLotteryStatus();
  }

  @Get('can-bet')
  @Public()  // æ·»åŠ è¿™ä¸ªè£…é¥°å™¨ï¼Œå…è®¸å…¬å¼€è®¿é—®
  @ApiOperation({ summary: 'æ£€æŸ¥å½“å‰æ˜¯å¦å¯ä»¥ä¸‹æ³¨' })
  @ApiResponse({ status: 200, description: 'è·å–æˆåŠŸ' })
  async canPlaceBet() {
    return this.countdownService.canPlaceBet();
  }
}
```

### æ–¹æ¡ˆ3ï¼šæ£€æŸ¥æ˜¯å¦éœ€è¦Token

å¦‚æœæ¥å£éœ€è¦Tokenè®¤è¯ï¼Œå‰ç«¯éœ€è¦å…ˆç™»å½•ï¼š

```typescript
// å‰ç«¯åœ¨è°ƒç”¨å‰ç¡®ä¿å·²ç™»å½•
const userStore = useUserStore()
if (!userStore.token) {
  // è·³è½¬åˆ°ç™»å½•é¡µ
  router.push('/login')
}
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. ç›´æ¥æµ‹è¯•åç«¯æ¥å£

ä½¿ç”¨æµè§ˆå™¨æˆ–Postmanæµ‹è¯•ï¼š

```bash
# æµ‹è¯•URL
GET http://localhost:3000/api/lottery/status
```

**é¢„æœŸè¿”å›**ï¼ˆä¸éœ€è¦Tokenï¼‰ï¼š
```json
{
  "currentPeriod": "3330422",
  "nextPeriod": "3330423",
  "status": "open",
  "canBet": true,
  "countdown": 145,
  "countdownText": "è·ç¦»å°ç›˜è¿˜æœ‰ 2 åˆ† 25 ç§’",
  "lastDrawTime": "2024-11-26 20:30:00",
  "nextDrawTime": "2024-11-26 20:33:30",
  "progressPercentage": 19.44,
  "serverTime": "2024-11-26 20:30:25"
}
```

**å¦‚æœéœ€è¦Token**ï¼š
```bash
# æ·»åŠ Authorizationå¤´
GET http://localhost:3000/api/lottery/status
Headers:
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 2. æ£€æŸ¥åç«¯æ—¥å¿—

æŸ¥çœ‹åç«¯æ§åˆ¶å°è¾“å‡ºï¼š
```bash
# åº”è¯¥çœ‹åˆ°è·¯ç”±æ³¨å†Œä¿¡æ¯
[Nest] 12345  - 2024/11/26 20:30:00     LOG [RouterExplorer] Mapped {/api/lottery/status, GET} route
```

### 3. è®¿é—®Swaggeræ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:3000/api-docs
```

åœ¨Swaggerä¸­æŸ¥æ‰¾ `/lottery/status` æ¥å£å¹¶æµ‹è¯•ã€‚

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥ï¼š

- [ ] åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼Ÿ
- [ ] è®¿é—® http://localhost:3000 æ˜¯å¦æœ‰å“åº”ï¼Ÿ
- [ ] è®¿é—® http://localhost:3000/api-docs æ˜¯å¦èƒ½çœ‹åˆ°APIæ–‡æ¡£ï¼Ÿ
- [ ] Swaggerä¸­æ˜¯å¦æœ‰ `/lottery/status` æ¥å£ï¼Ÿ
- [ ] åœ¨Swaggerä¸­æµ‹è¯•è¯¥æ¥å£æ˜¯å¦æˆåŠŸï¼Ÿ
- [ ] æ£€æŸ¥åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ï¼Ÿ
- [ ] å‰ç«¯ä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
- [ ] å‰ç«¯è¯·æ±‚çš„URLæ˜¯å¦æ­£ç¡®ï¼Ÿ

---

## ğŸ”§ å¿«é€Ÿä¿®å¤æ­¥éª¤

### æ­¥éª¤1ï¼šé‡å¯åç«¯
```bash
# è¿›å…¥åç«¯ç›®å½•
cd D:\download\yunce\yunce\score-system\backend

# åœæ­¢å½“å‰æœåŠ¡ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰
# æŒ‰ Ctrl+C

# é‡æ–°å¯åŠ¨
npm run start:dev
```

### æ­¥éª¤2ï¼šç­‰å¾…å¯åŠ¨å®Œæˆ
çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯è¯´æ˜å¯åŠ¨æˆåŠŸï¼š
```
[Nest] INFO ğŸš€ åº”ç”¨å¯åŠ¨æˆåŠŸï¼
[Nest] INFO ğŸ“¡ APIåœ°å€: http://localhost:3000/api
[Nest] INFO ğŸ“š APIæ–‡æ¡£: http://localhost:3000/api-docs
```

### æ­¥éª¤3ï¼šæµ‹è¯•æ¥å£
æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:3000/api/lottery/status
```

### æ­¥éª¤4ï¼šåˆ·æ–°å‰ç«¯
```bash
# å¦‚æœåç«¯æ­£å¸¸ï¼Œåˆ·æ–°å‰ç«¯é¡µé¢
# è®¿é—® http://localhost:5173
```

---

## ğŸ’¡ å…¶ä»–å¯èƒ½çš„é—®é¢˜

### 1. ç«¯å£å†²çª
å¦‚æœ3000ç«¯å£è¢«å ç”¨ï¼š
```bash
# WindowsæŸ¥æ‰¾å ç”¨3000ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :3000

# æ€æ­»è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F
```

### 2. ä¾èµ–æœªå®‰è£…
```bash
cd backend
npm install
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥
æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®ï¼š
```env
DATABASE_URL="mysql://..."
```

---

## ğŸ“Š é—®é¢˜æ€»ç»“

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ | ä¼˜å…ˆçº§ |
|------|------|---------|--------|
| 404é”™è¯¯ | åç«¯æœªé‡å¯ | é‡å¯åç«¯æœåŠ¡ | â­â­â­ |
| 404é”™è¯¯ | éœ€è¦è®¤è¯ | æ·»åŠ @Publicè£…é¥°å™¨ | â­â­ |
| 404é”™è¯¯ | æ¨¡å—æœªå¯¼å…¥ | æ£€æŸ¥app.module.ts | â­ |
| 404é”™è¯¯ | ç«¯å£é…ç½®é”™è¯¯ | æ£€æŸ¥å‰ç«¯ä»£ç†é…ç½® | â­ |

---

## âœ… é¢„æœŸç»“æœ

ä¿®å¤åï¼Œå‰ç«¯åº”è¯¥èƒ½å¤Ÿæ­£å¸¸è°ƒç”¨ `/api/lottery/status` æ¥å£ï¼Œè¿”å›ç±»ä¼¼ï¼š

```json
{
  "currentPeriod": "3330422",
  "nextPeriod": "3330423",
  "status": "open",
  "canBet": true,
  "countdown": 145,
  "countdownText": "è·ç¦»å°ç›˜è¿˜æœ‰ 2 åˆ† 25 ç§’",
  ...
}
```

é¦–é¡µçš„å€’è®¡æ—¶åº”è¯¥æ­£å¸¸æ˜¾ç¤ºï¼

---

**æœ€å¯èƒ½çš„åŸå› **ï¼šâ­â­â­ **åç«¯æœåŠ¡æœªé‡å¯**

**å¿«é€Ÿè§£å†³**ï¼šé‡å¯åç«¯æœåŠ¡å³å¯ï¼

```bash
cd backend
npm run start:dev
```




