# å€’è®¡æ—¶ç²¾åº¦ä¿®å¤ - è§£å†³å¿«1ç§’é—®é¢˜

## é—®é¢˜æè¿°

**ç°è±¡ï¼š** é¦–é¡µçš„å°ç›˜å€’è®¡æ—¶æ˜¾ç¤ºä¼šæ¯”å®é™…å¿«çº¦1ç§’ã€‚

**å½±å“ï¼š** 
- ç”¨æˆ·çœ‹åˆ°å€’è®¡æ—¶ä¸º 0 ç§’æ—¶ï¼Œå®é™…å¯èƒ½è¿˜å‰© 0.x ç§’
- å¯èƒ½å¯¼è‡´ç”¨æˆ·è¯¯ä»¥ä¸ºå·²ç»å°ç›˜ï¼Œä½†å®é™…è¿˜å¯ä»¥ä¸‹æ³¨
- æˆ–åè¿‡æ¥ï¼Œå€’è®¡æ—¶è¿˜æœ‰1ç§’ï¼Œä½†å®é™…å·²ç»å°ç›˜

---

## é—®é¢˜åŸå› 

### åŸå§‹ä»£ç 

```typescript
const calculateCountdown = (): number => {
  // ...
  const closeTime = parseTimeString(lotteryStatus.value.currentCloseTime)
  const now = Date.now() + serverTimeOffset.value
  
  if (now < closeTime) {
    return Math.max(0, Math.floor((closeTime - now) / 1000))  // âŒ å‘ä¸‹å–æ•´
  }
  // ...
}
```

### é—®é¢˜åˆ†æ

ä½¿ç”¨ `Math.floor()` å‘ä¸‹å–æ•´ä¼šå¯¼è‡´å€’è®¡æ—¶"å¿«"ï¼š

| å®é™…å‰©ä½™æ—¶é—´ | `Math.floor()` ç»“æœ | æ˜¾ç¤º | é—®é¢˜ |
|------------|-------------------|------|------|
| 59.8 ç§’ | `floor(59.8)` = 59 | 59ç§’ | âŒ å¿«äº† 0.8 ç§’ |
| 59.2 ç§’ | `floor(59.2)` = 59 | 59ç§’ | âŒ å¿«äº† 0.2 ç§’ |
| 59.0 ç§’ | `floor(59.0)` = 59 | 59ç§’ | âœ… å‡†ç¡® |

**å…³é”®é—®é¢˜ï¼š** å½“å®é™…è¿˜å‰© 59.8 ç§’æ—¶ï¼Œæ˜¾ç¤º 59 ç§’ï¼Œç”¨æˆ·ä¼šè¯¯ä»¥ä¸ºè¿‡äº† 0.8 ç§’ã€‚

---

## è§£å†³æ–¹æ¡ˆ

### ä¿®æ”¹æ–¹æ¡ˆ

å°† `Math.floor()` æ”¹ä¸º `Math.ceil()` **å‘ä¸Šå–æ•´**ï¼š

```typescript
const calculateCountdown = (): number => {
  // ...
  const closeTime = parseTimeString(lotteryStatus.value.currentCloseTime)
  const now = Date.now() + serverTimeOffset.value
  
  if (now < closeTime) {
    return Math.max(0, Math.ceil((closeTime - now) / 1000))  // âœ… å‘ä¸Šå–æ•´
  }
  
  if (now < drawTime) {
    return Math.max(0, Math.ceil((drawTime - now) / 1000))  // âœ… å‘ä¸Šå–æ•´
  }
  // ...
}
```

### æ•ˆæœå¯¹æ¯”

| å®é™…å‰©ä½™æ—¶é—´ | `Math.floor()` | `Math.ceil()` | å“ªä¸ªæ›´å‡†ç¡®ï¼Ÿ |
|------------|----------------|---------------|------------|
| 59.8 ç§’ | 59 ç§’ | 60 ç§’ | âœ… `ceil()` (ä¿å®ˆ) |
| 59.2 ç§’ | 59 ç§’ | 60 ç§’ | âœ… `ceil()` (ä¿å®ˆ) |
| 59.0 ç§’ | 59 ç§’ | 59 ç§’ | âœ… ä¸¤è€…ç›¸åŒ |
| 0.1 ç§’ | 0 ç§’ | 1 ç§’ | âœ… `ceil()` (é¿å…è¿‡æ—©æ˜¾ç¤º0) |

**`Math.ceil()` çš„ä¼˜åŠ¿ï¼š**
- âœ… å€’è®¡æ—¶æ›´åŠ **ä¿å®ˆ**ï¼ˆä¸ä¼šè¿‡æ—©æ˜¾ç¤º0ï¼‰
- âœ… ç”¨æˆ·ä½“éªŒæ›´å¥½ï¼ˆä¸ä¼šè¯¯ä»¥ä¸ºå·²ç»å°ç›˜ï¼‰
- âœ… ç¬¦åˆå€’è®¡æ—¶çš„å¸¸è§é€»è¾‘ï¼ˆå®å¯å¤šç­‰1ç§’ï¼Œä¸è¦å°‘ç­‰1ç§’ï¼‰

---

## ä»£ç å˜æ›´

### ä¿®æ”¹æ–‡ä»¶
`frontend-h5/src/views/Home.vue`

### å˜æ›´è¯¦æƒ…

```diff
const calculateCountdown = (): number => {
  if (!lotteryStatus.value) return 0
  
  const now = Date.now() + serverTimeOffset.value
  const closeTime = parseTimeString(lotteryStatus.value.currentCloseTime)
  const drawTime = parseTimeString(lotteryStatus.value.currentDrawTime)
  
  // å¦‚æœå°ç›˜æ—¶é—´è¿˜æ²¡åˆ°ï¼Œæ˜¾ç¤ºè·ç¦»å°ç›˜çš„å€’è®¡æ—¶
  if (now < closeTime) {
-   return Math.max(0, Math.floor((closeTime - now) / 1000))
+   // ä½¿ç”¨ Math.ceil å‘ä¸Šå–æ•´ï¼Œé¿å…å€’è®¡æ—¶å¿«1ç§’
+   return Math.max(0, Math.ceil((closeTime - now) / 1000))
  }
  
  // å¦‚æœå¼€å¥–æ—¶é—´è¿˜æ²¡åˆ°ï¼Œæ˜¾ç¤ºè·ç¦»å¼€å¥–çš„å€’è®¡æ—¶
  if (now < drawTime) {
-   return Math.max(0, Math.floor((drawTime - now) / 1000))
+   // ä½¿ç”¨ Math.ceil å‘ä¸Šå–æ•´ï¼Œé¿å…å€’è®¡æ—¶å¿«1ç§’
+   return Math.max(0, Math.ceil((drawTime - now) / 1000))
  }
  
  return 0
}
```

---

## å®é™…æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹1ï¼šå°ç›˜å€’è®¡æ—¶

**æœåŠ¡å™¨æ—¶é—´ï¼š** 2025-11-29 10:00:00.000  
**å°ç›˜æ—¶é—´ï¼š** 2025-11-29 10:01:00.000  
**å½“å‰å®¢æˆ·ç«¯æ—¶é—´ï¼ˆæ ¡å‡†åï¼‰ï¼š** 2025-11-29 10:00:00.200

| æ—¶é—´ç‚¹ | å®é™…å‰©ä½™ | `Math.floor()` | `Math.ceil()` | è¯´æ˜ |
|-------|---------|----------------|---------------|------|
| 10:00:00.200 | 59.8ç§’ | 59ç§’ | **60ç§’** âœ… | ceil æ›´å‡†ç¡® |
| 10:00:01.200 | 58.8ç§’ | 58ç§’ | **59ç§’** âœ… | ceil æ›´å‡†ç¡® |
| 10:00:59.200 | 0.8ç§’ | 0ç§’ âŒ | **1ç§’** âœ… | floor è¿‡æ—©æ˜¾ç¤º0 |
| 10:01:00.000 | 0ç§’ | 0ç§’ | 0ç§’ | ä¸¤è€…ç›¸åŒ |

**ç»“è®ºï¼š** `Math.ceil()` é¿å…äº†è¿‡æ—©æ˜¾ç¤º 0 ç§’çš„é—®é¢˜ã€‚

---

## ç”¨æˆ·ä½“éªŒæå‡

### ä¿®å¤å‰ï¼ˆä½¿ç”¨ `Math.floor()`ï¼‰

```
å®é™…å‰©ä½™ 1.5 ç§’
æ˜¾ç¤ºï¼šè·ç¦»å°ç›˜ 1 ç§’   â† å¿«äº†0.5ç§’ï¼Œå¯èƒ½è¯¯å¯¼ç”¨æˆ·

å®é™…å‰©ä½™ 0.5 ç§’
æ˜¾ç¤ºï¼šè·ç¦»å°ç›˜ 0 ç§’   â† è¿‡æ—©æ˜¾ç¤º0ï¼Œä½†å®é™…è¿˜èƒ½ä¸‹æ³¨0.5ç§’ï¼
```

### ä¿®å¤åï¼ˆä½¿ç”¨ `Math.ceil()`ï¼‰

```
å®é™…å‰©ä½™ 1.5 ç§’
æ˜¾ç¤ºï¼šè·ç¦»å°ç›˜ 2 ç§’   â† ä¿å®ˆæ˜¾ç¤ºï¼Œä¸ä¼šè¯¯å¯¼

å®é™…å‰©ä½™ 0.5 ç§’
æ˜¾ç¤ºï¼šè·ç¦»å°ç›˜ 1 ç§’   â† å‡†ç¡®ï¼Œç”¨æˆ·çŸ¥é“è¿˜æœ‰æ—¶é—´
```

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **è®¿é—®é¦–é¡µ**
   ```
   - ç™»å½•ç³»ç»Ÿ
   - æŸ¥çœ‹å€’è®¡æ—¶æ˜¾ç¤º
   ```

2. **å¯¹æ¯”æœåŠ¡å™¨æ—¶é—´**
   ```
   - æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
   - æŸ¥çœ‹æ—¥å¿—ï¼šğŸ• æ—¶é—´åŒæ­¥ä¿¡æ¯
   - å¯¹æ¯”å°ç›˜æ—¶é—´å’Œå€’è®¡æ—¶
   ```

3. **è§‚å¯Ÿæœ€åå‡ ç§’**
   ```
   - é‡ç‚¹è§‚å¯Ÿå€’è®¡æ—¶æœ€å 5 ç§’
   - éªŒè¯ï¼šå€’è®¡æ—¶ä¸º 1 ç§’æ—¶ï¼Œå®é™…è‡³å°‘è¿˜æœ‰ 0.1 ç§’
   - éªŒè¯ï¼šå€’è®¡æ—¶ä¸º 0 ç§’æ—¶ï¼Œç¡®å®å·²ç»åˆ°è¾¾å°ç›˜æ—¶é—´
   ```

### é¢„æœŸç»“æœ

| æµ‹è¯•åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|---------|-------|-------|
| è·ç¦»å°ç›˜ 59.8 ç§’ | æ˜¾ç¤º 59 ç§’ âŒ | æ˜¾ç¤º 60 ç§’ âœ… |
| è·ç¦»å°ç›˜ 0.5 ç§’ | æ˜¾ç¤º 0 ç§’ âŒ | æ˜¾ç¤º 1 ç§’ âœ… |
| å€’è®¡æ—¶ä¸º 0 æ—¶ | å¯èƒ½è¿˜å‰© 0.9 ç§’ âŒ | ç¡®å®ä¸º 0 ç§’ âœ… |

---

## æŠ€æœ¯ç»†èŠ‚

### æ—¶é—´è®¡ç®—æµç¨‹

```typescript
// 1. è·å–æœåŠ¡å™¨æ—¶é—´åç§»é‡ï¼ˆåœ¨ loadCurrentData ä¸­è®¡ç®—ï¼‰
const requestTime = Date.now()
const res = await getLotteryStatus()
const responseTime = Date.now()
const networkDelay = (responseTime - requestTime) / 2
const serverTime = parseTimeString(statusData.serverTime)
serverTimeOffset.value = serverTime + networkDelay - responseTime

// 2. ä½¿ç”¨æ ¡å‡†åçš„å®¢æˆ·ç«¯æ—¶é—´ï¼ˆåœ¨ calculateCountdown ä¸­ä½¿ç”¨ï¼‰
const now = Date.now() + serverTimeOffset.value

// 3. è®¡ç®—å‰©ä½™æ¯«ç§’æ•°
const remainingMs = closeTime - now  // ä¾‹å¦‚ï¼š59800 æ¯«ç§’

// 4. è½¬æ¢ä¸ºç§’æ•°ï¼ˆå…³é”®ï¼šä½¿ç”¨ Math.ceil å‘ä¸Šå–æ•´ï¼‰
const remainingSeconds = Math.ceil(remainingMs / 1000)  // 60 ç§’ âœ…
// å¦‚æœä½¿ç”¨ Math.floorï¼š
// const remainingSeconds = Math.floor(59800 / 1000)  // 59 ç§’ âŒ
```

### ä¸ºä»€ä¹ˆ `Math.ceil()` æ›´åˆé€‚ï¼Ÿ

1. **å€’è®¡æ—¶çš„æœ¬è´¨**
   - å€’è®¡æ—¶æ˜¯å‘Šè¯‰ç”¨æˆ·"è¿˜å‰©å¤šå°‘æ—¶é—´"
   - å®å¯å¤šç»™ç”¨æˆ·ä¸€ç‚¹æ—¶é—´ï¼Œä¸è¦å°‘ç»™

2. **é¿å…ç«æ€æ¡ä»¶**
   - å¦‚æœå€’è®¡æ—¶æ˜¾ç¤º 0 ç§’ï¼Œä½†å®é™…è¿˜å‰© 0.5 ç§’
   - ç”¨æˆ·å¯èƒ½åœ¨è¿™ 0.5 ç§’å†…æäº¤ä¸‹æ³¨ï¼Œä½†çœ‹åˆ°"å·²å°ç›˜"çš„é”™è¯¯
   - ä½¿ç”¨ `Math.ceil()` å¯ä»¥é¿å…è¿™ç§æƒ…å†µ

3. **ç¬¦åˆç”¨æˆ·é¢„æœŸ**
   - å¤§å¤šæ•°å€’è®¡æ—¶åº”ç”¨ï¼ˆå¦‚æ·˜å®ç§’æ€ã€æŠ¢ç¥¨ç³»ç»Ÿï¼‰éƒ½ä½¿ç”¨å‘ä¸Šå–æ•´
   - ç”¨æˆ·ä¹ æƒ¯äº†è¿™ç§"ä¿å®ˆ"çš„å€’è®¡æ—¶æ˜¾ç¤º

---

## å…¶ä»–å¯èƒ½çš„æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå››èˆäº”å…¥ `Math.round()`

```typescript
return Math.max(0, Math.round((closeTime - now) / 1000))
```

**ä¼˜ç‚¹ï¼š** æ›´æ¥è¿‘å®é™…å€¼  
**ç¼ºç‚¹ï¼š** 
- å®é™…å‰©ä½™ 0.4 ç§’æ—¶ï¼Œæ˜¾ç¤º 0 ç§’ï¼ˆè¿‡æ—©ï¼‰
- ä¸å¦‚ `Math.ceil()` ä¿å®ˆ

### æ–¹æ¡ˆ2ï¼šä¿ç•™å°æ•°ç‚¹

```typescript
return Math.max(0, ((closeTime - now) / 1000).toFixed(1))  // è¿”å› "59.8"
```

**ä¼˜ç‚¹ï¼š** æœ€ç²¾ç¡®  
**ç¼ºç‚¹ï¼š** 
- æ˜¾ç¤ºå°æ•°ä¸ç¾è§‚
- ç”¨æˆ·ä¹ æƒ¯çœ‹æ•´æ•°å€’è®¡æ—¶

### âœ… æ¨èæ–¹æ¡ˆï¼š`Math.ceil()` å‘ä¸Šå–æ•´

æœ€ç¬¦åˆå€’è®¡æ—¶çš„ä½¿ç”¨åœºæ™¯ï¼Œç”¨æˆ·ä½“éªŒæœ€å¥½ã€‚

---

## ç›¸å…³æ–‡ä»¶

- `frontend-h5/src/views/Home.vue` - å€’è®¡æ—¶è®¡ç®—é€»è¾‘
- `frontend-h5/src/stores/lottery.ts` - å€’è®¡æ—¶çŠ¶æ€ç®¡ç†

---

ä¿®å¤å®Œæˆï¼ğŸ‰

ç°åœ¨å€’è®¡æ—¶ä¼šæ›´åŠ å‡†ç¡®ï¼Œä¸ä¼šå†å‡ºç°"å¿«1ç§’"çš„é—®é¢˜ã€‚


