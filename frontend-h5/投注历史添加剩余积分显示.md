# 投注历史添加剩余积分显示

## 修改内容

在**投注历史**页面添加了**结算后的剩余积分**列，方便用户查看每笔订单结算后的账户余额。

---

## 修改文件

```
frontend-h5/
└── src/
    └── views/
        └── BetHistory.vue  (已修改)
```

---

## 功能说明

### 1. 新增显示列

在投注历史表格中新增**"剩余"**列，显示每笔订单结算后的账户剩余积分。

#### 表头结构（修改后）
| 期号 | 开奖号码 | 下注 | 结果 | **剩余** |
|------|---------|------|------|----------|
| 364706 | 2 0 9 | 1000 | -830 | **96969** |
| 364706 | 2 0 9 | 单 | +950 | **98749** |

### 2. 显示规则

#### 已结算订单
- 显示 `pointsAfter` 字段的值
- 使用 `formatMoney()` 格式化显示
- 字体大小：12px
- 颜色：#333（深灰色）
- 字体粗细：600

#### 未结算订单
- 显示 "-"（横杠）
- 字体大小：12px
- 颜色：#999（浅灰色）

---

## 界面效果

### 示例数据

```
期号      开奖号码    下注      结果      剩余
364706    2 0 9      1000     -830      96969
364706    2 0 9      单       +950      98749
364706    2 0 9      100      -83       97716
364686    8 6 9      小       -50       99899
364685    (未开奖)   500      未结算     -
```

### 布局调整

为了适应新增的列，对各列宽度进行了微调：

**修改前：**
- 期号：60px
- 开奖号码：80px
- 下注：flex: 1 (最小60px)
- 结果：70px

**修改后：**
- 期号：55px（-5px）
- 开奖号码：75px（-5px）
- 下注：flex: 1 (最小50px，-10px）
- 结果：60px（-10px）
- **剩余：60px（新增）**

通过微调各列宽度，在不增加总宽度的情况下容纳了新列。

---

## 技术实现

### HTML 结构

#### 表头部分
```vue
<div class="table-header">
  <div class="header-col issue-col">期号</div>
  <div class="header-col lottery-col">开奖号码</div>
  <div class="header-col bet-col">下注</div>
  <div class="header-col result-col">结果</div>
  <div class="header-col balance-col">剩余</div>  <!-- 新增 -->
</div>
```

#### 数据行部分
```vue
<!-- 剩余积分 -->
<div class="data-col balance-col">
  <div v-if="item.status === 'pending'" class="balance-pending">
    -
  </div>
  <div v-else class="balance-amount">
    {{ formatMoney(item.pointsAfter) }}
  </div>
</div>
```

### CSS 样式

#### 表头样式
```scss
.balance-col {
  width: 60px;
  flex-shrink: 0;
}
```

#### 数据行样式
```scss
.balance-col {
  width: 60px;
  flex-shrink: 0;

  .balance-pending {
    font-size: 12px;
    color: #999;
  }

  .balance-amount {
    font-size: 12px;
    font-weight: 600;
    color: #333;
    text-align: center;
  }
}
```

---

## 数据来源

### 后端API

剩余积分数据来自后端 `/api/user/bet-history` 接口，字段名为 `pointsAfter`。

#### 响应数据示例
```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": "5",
        "issue": "3364706",
        "betType": "multiple",
        "betContent": "1000",
        "amount": "1000",
        "status": "loss",
        "resultAmount": "-830",
        "pointsBefore": "98799",
        "pointsAfter": "96969",  // 剩余积分
        "settledAt": "2025-11-26T21:27:01.175Z",
        "lottery": {
          "number1": 2,
          "number2": 0,
          "number3": 9
        }
      }
    ],
    "total": 4,
    "page": 1,
    "limit": 20
  }
}
```

### 字段说明

- **pointsBefore**：下注前的积分（现有字段，未显示）
- **pointsAfter**：结算后的积分（新增显示）
- **resultAmount**：盈亏金额（现有显示）

三者关系：
```
pointsAfter = pointsBefore + resultAmount
```

例如：
```
下注前：98799
盈亏：-830
结算后：96969 (98799 - 830)
```

---

## 用户价值

### 1. 清晰的资金流水
用户可以直观看到每笔订单后的账户余额，便于对账。

### 2. 快速定位问题
如果用户对某笔订单有疑问，可以通过剩余积分快速验证计算是否正确。

### 3. 历史追溯
用户可以追溯任意时间点的账户余额，了解资金变化。

---

## 测试场景

### 场景1：已结算订单显示剩余积分
1. 进入投注历史页面
2. 查看已结算的订单
3. ✅ 验证"剩余"列显示正确的 `pointsAfter` 值
4. ✅ 验证数值格式化正确（千分位分隔）
5. ✅ 验证字体样式（12px，600字重，#333颜色）

### 场景2：未结算订单显示横杠
1. 进入投注历史页面
2. 查看未结算的订单
3. ✅ 验证"剩余"列显示"-"
4. ✅ 验证横杠颜色为浅灰色（#999）

### 场景3：列宽适配
1. 在不同屏幕尺寸下查看
2. ✅ 验证各列宽度合理，不会溢出
3. ✅ 验证"下注"列作为弹性列正确填充剩余空间
4. ✅ 验证水平滚动（如有）流畅

### 场景4：数据正确性验证
1. 选择一条已结算的订单
2. 记录：下注前积分（A）、盈亏金额（B）、剩余积分（C）
3. ✅ 验证：C = A + B
4. 如不符，检查是否是同一期多次下注（需要累加）

### 场景5：跨页加载
1. 滚动到底部触发加载更多
2. ✅ 验证新加载的数据也正确显示剩余积分
3. ✅ 验证无重复或遗漏

---

## 注意事项

### 1. 同一期多次下注
如果用户在同一期下注多次，后端已经合并显示为一条记录：
- `pointsAfter` 显示的是该期**最后一次下注结算后**的积分
- `resultAmount` 是该期**所有下注的总盈亏**

### 2. 数据格式化
使用 `formatMoney()` 工具函数格式化积分显示：
- 添加千分位分隔符
- 保留小数点（如果需要）
- 示例：96969 → "96,969"

### 3. 响应式设计
在小屏幕设备上，如果表格宽度超出屏幕：
- 表格可以水平滚动
- 表头固定在顶部，不随滚动消失
- 保证用户体验

---

## 未来优化建议

### 1. 添加积分变化趋势图
在投注历史页面顶部添加一个小型折线图，展示积分变化趋势。

### 2. 高亮异常订单
如果某笔订单的剩余积分与预期不符（计算错误），用红色高亮显示。

### 3. 添加筛选功能
允许用户按剩余积分范围筛选订单，如"剩余积分<1000"。

### 4. 导出功能
支持导出投注历史为Excel或CSV，包含剩余积分列，便于用户做进一步分析。

---

## 总结

✅ **功能完成**：投注历史页面已成功添加"剩余积分"列
✅ **数据来源**：使用后端返回的 `pointsAfter` 字段
✅ **显示规则**：已结算显示积分，未结算显示"-"
✅ **布局优化**：微调列宽，保持整体布局协调
✅ **用户价值**：提供清晰的资金流水，便于对账和追溯

该功能提升了投注历史页面的信息完整性，帮助用户更好地管理和追踪账户资金！💰





