# 📱 H5页面结构修正说明

## ✅ 修正完成

根据用户反馈，已将页面结构修正为正确的5个页面。

---

## 🎯 正确的页面结构

### 底部导航栏（5个Tab）

| 序号 | 页面名称 | 路由 | 组件 | 图标 | 说明 |
|------|---------|------|------|------|------|
| 1 | 首页 | `/` | Home.vue | home-o | 下注面板、倒计时 |
| 2 | 投注历史 | `/bet-history` | **BetHistory.vue** | orders-o | **新增**：已结/未结明细 |
| 3 | 开奖历史 | `/lottery-history` | History.vue | records-o | 开奖记录、期号搜索 |
| 4 | 积分账单 | `/point-records` | PointRecords.vue | gold-coin-o | **修改**：只显示上下分 |
| 5 | 个人中心 | `/profile` | Profile.vue | user-o | 用户信息、统计 |

---

## 🔄 主要修改内容

### 1. 新增"投注历史"页面 ✅

**文件**：`src/views/BetHistory.vue`

**功能**：
- ✅ Tab切换：未结明细 / 已结明细
- ✅ 未结明细：显示未结算的投注记录
- ✅ 已结明细：显示已结算的投注记录（中奖/未中奖）
- ✅ 下拉刷新
- ✅ 分页加载
- ✅ 骨架屏

**显示内容**：
- 期号
- 下注类型（倍数下注/组合下注）
- 下注内容
- 下注金额
- 手续费
- 结算状态（未结算/已中奖/未中奖）
- 中奖金额（已结算时显示）
- 结算时间

---

### 2. 修正"积分账单"页面 ✅

**文件**：`src/views/PointRecords.vue`

**修改**：
- ✅ 标题改为"积分账单"
- ✅ 筛选选项修改：只保留上下分相关类型
  - 全部类型
  - 充值
  - 扣款
  - 管理员加分
  - 管理员扣分
- ✅ **移除**：下注、中奖、手续费（这些在投注历史中显示）

**用途**：
- 只显示积分的上下分记录
- 不显示下注、中奖等投注相关记录

---

### 3. 更新所有页面的底部导航 ✅

**修改文件**：
- `Home.vue` - activeTab: 0
- `BetHistory.vue` - activeTab: 1（新增）
- `History.vue` - activeTab: 2
- `PointRecords.vue` - activeTab: 3
- `Profile.vue` - activeTab: 4

**新的导航栏**：
```vue
<van-tabbar v-model="activeTab" route fixed>
  <van-tabbar-item icon="home-o" to="/">首页</van-tabbar-item>
  <van-tabbar-item icon="orders-o" to="/bet-history">投注历史</van-tabbar-item>
  <van-tabbar-item icon="records-o" to="/lottery-history">开奖历史</van-tabbar-item>
  <van-tabbar-item icon="gold-coin-o" to="/point-records">积分账单</van-tabbar-item>
  <van-tabbar-item icon="user-o" to="/profile">我的</van-tabbar-item>
</van-tabbar>
```

---

### 4. 更新路由配置 ✅

**文件**：`src/router/index.ts`

**修改**：
```typescript
// 新增投注历史路由
{
  path: '/bet-history',
  name: 'BetHistory',
  component: () => import('@/views/BetHistory.vue'),
  meta: { title: '投注历史', requiresAuth: true },
},

// 修改开奖历史路由路径
{
  path: '/lottery-history',  // 原来是 /history
  name: 'LotteryHistory',
  component: () => import('@/views/History.vue'),
  meta: { title: '开奖历史', requiresAuth: true },
},

// 积分账单标题修改
{
  path: '/point-records',
  name: 'PointRecords',
  component: () => import('@/views/PointRecords.vue'),
  meta: { title: '积分账单', requiresAuth: true },  // 原来是"积分记录"
},
```

---

### 5. 新增下注历史API ✅

**文件**：`src/api/bet.ts`

**新增接口**：
```typescript
// 获取用户下注历史
export function getUserBetHistory(params: BetHistoryParams) {
  return request<ApiResponse<PageData<BetRecord>>>({
    url: '/user/bet-history',
    method: 'get',
    params,
  })
}
```

**参数**：
```typescript
interface BetHistoryParams {
  page: number
  limit: number
  status?: 'pending' | 'settled'  // 未结算/已结算
  issue?: string  // 可选：按期号筛选
}
```

---

## 📊 页面对比

### 修改前（错误）❌

| 页面 | 路由 | 说明 |
|------|------|------|
| 首页 | `/` | ✅ 正确 |
| ~~历史~~ | `/history` | ❌ 混淆：应该是"投注历史" |
| - | - | ❌ 缺少"开奖历史" |
| 积分记录 | `/point-records` | ❌ 混淆：包含了下注、中奖记录 |
| 我的 | `/profile` | ✅ 正确 |

### 修改后（正确）✅

| 页面 | 路由 | 说明 |
|------|------|------|
| 首页 | `/` | ✅ 下注面板 |
| **投注历史** | `/bet-history` | ✅ **新增**：已结/未结 |
| **开奖历史** | `/lottery-history` | ✅ 开奖记录 |
| **积分账单** | `/point-records` | ✅ **修正**：只显示上下分 |
| 我的 | `/profile` | ✅ 个人信息 |

---

## 🎨 投注历史页面详情

### Tab 1: 未结明细

**显示内容**：
```
┌─────────────────────────┐
│ [未结算]    11-26 20:30  │
├─────────────────────────┤
│ 期号：3330422            │
│ 类型：倍数下注           │
│ 内容：100               │
│ 金额：100.00            │
│ 手续费：3.00            │
└─────────────────────────┘
```

**特点**：
- 显示所有未结算的投注
- 等待开奖结算
- 状态标签：橙色"未结算"

### Tab 2: 已结明细

**已中奖**：
```
┌─────────────────────────┐
│ [已中奖]    11-26 20:30  │
├─────────────────────────┤
│ 期号：3330421            │
│ 类型：组合下注           │
│ 内容：大                │
│ 金额：100.00            │
│ 手续费：5.00            │
│ 中奖金额：+95.00        │ ✅ 绿色
│ 结算时间：11-26 20:33   │
└─────────────────────────┘
```

**未中奖**：
```
┌─────────────────────────┐
│ [未中奖]    11-26 20:30  │
├─────────────────────────┤
│ 期号：3330421            │
│ 类型：倍数下注           │
│ 内容：100               │
│ 金额：100.00            │
│ 手续费：3.00            │
│ 损失金额：-103.00       │ ❌ 红色
│ 结算时间：11-26 20:33   │
└─────────────────────────┘
```

---

## 📋 积分账单页面修正

### 修改前（混淆）❌

筛选类型包括：
- 全部类型
- 充值
- 扣款
- **下注** ❌
- **中奖** ❌
- **手续费** ❌
- 管理员充值
- 管理员扣款

### 修改后（正确）✅

筛选类型只包括：
- 全部类型
- 充值
- 扣款
- 管理员加分
- 管理员扣分

**说明**：
- 下注、中奖、手续费相关记录在"投注历史"中查看
- 积分账单只显示纯粹的上下分操作

---

## 🔌 后端API需求

### 投注历史接口

**接口**：`GET /api/user/bet-history`

**参数**：
```typescript
{
  page: number
  limit: number
  status?: 'pending' | 'settled'  // 未结算/已结算
  issue?: string  // 可选：按期号筛选
}
```

**返回**：
```typescript
{
  code: 200,
  data: {
    list: [
      {
        id: 1,
        userId: 1,
        issue: "3330422",
        betType: "multiple",
        betContent: "100",
        amount: 100,
        fee: 3,
        isWin: null,  // null: 未结算, 1: 已中奖, 0: 未中奖
        winAmount: null,
        settleTime: null,
        createdAt: "2024-11-26T20:30:00.000Z"
      }
    ],
    total: 50,
    page: 1,
    limit: 20,
    totalPages: 3
  }
}
```

---

## ✅ 修改完成清单

- [x] 创建BetHistory.vue（投注历史页面）
- [x] 修改PointRecords.vue（移除投注相关类型）
- [x] 更新所有页面的底部导航栏
- [x] 更新路由配置
- [x] 创建bet.ts API文件
- [x] 更新activeTab索引

---

## 🧪 测试建议

### 1. 投注历史测试

**未结明细**：
1. 进行一次下注
2. 查看"投注历史"页面
3. 切换到"未结明细"tab
4. 应该能看到刚才的下注记录

**已结明细**：
1. 等待开奖结算
2. 切换到"已结明细"tab
3. 应该能看到已结算的记录
4. 中奖记录显示绿色金额
5. 未中奖记录显示红色金额

### 2. 积分账单测试

1. 管理员进行加分/扣分操作
2. 查看"积分账单"页面
3. 应该只看到上下分记录
4. 不应该看到下注、中奖、手续费记录

### 3. 导航测试

1. 点击底部导航栏的各个tab
2. 检查是否正确跳转
3. 检查activeTab是否正确高亮

---

## 📝 总结

### 页面职责划分

| 页面 | 职责 | 不包含 |
|------|------|--------|
| 首页 | 下注操作 | - |
| 投注历史 | 投注记录、结算明细 | - |
| 开奖历史 | 开奖结果 | 投注信息 |
| 积分账单 | 上下分记录 | 投注、中奖记录 |
| 个人中心 | 用户信息、统计 | - |

### 核心区别

- **投注历史**：我下了哪些注？中了吗？
- **开奖历史**：开出了什么号码？
- **积分账单**：我的积分怎么变化的？（只关注充值/扣款）

---

**修正完成！** ✅

现在H5有完整的5个页面，职责清晰，不再混淆！🎉




