# ğŸš€ å¤šå®ä¾‹éƒ¨ç½² - å¿«é€Ÿå¼€å§‹

ä¸€åˆ†é’Ÿå¿«é€Ÿåœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²ç¬¬äºŒå¥—ç³»ç»Ÿï¼

---

## æœ€ç®€å•çš„æ–¹å¼

### æ­¥éª¤1: èµ‹äºˆæ‰§è¡Œæƒé™

```bash
cd /root/score-system
chmod +x create-instance.sh manage-instances.sh
```

### æ­¥éª¤2: åˆ›å»ºæ–°å®ä¾‹

```bash
# åˆ›å»ºå®ä¾‹2ï¼ˆè‡ªåŠ¨é…ç½®æ‰€æœ‰ç«¯å£ï¼‰
./create-instance.sh instance2 "å®¢æˆ·Aç³»ç»Ÿ"
```

**å°±è¿™ä¹ˆç®€å•ï¼** ğŸ‰

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… å¤åˆ¶ä»£ç åˆ°æ–°ç›®å½• `/root/score-system-instance2`
- âœ… ç”Ÿæˆå®‰å…¨çš„éšæœºå¯†ç 
- âœ… åˆ†é…ä¸åŒçš„ç«¯å£ï¼ˆMySQL: 3308, Backend: 3001, H5: 5175, Admin: 5176ï¼‰
- âœ… å¯åŠ¨ Docker å®¹å™¨
- âœ… åˆå§‹åŒ–æ•°æ®åº“

---

## è®¿é—®æ–°å®ä¾‹

è„šæœ¬æ‰§è¡Œå®Œæˆåä¼šæ˜¾ç¤ºè®¿é—®åœ°å€ï¼Œä¾‹å¦‚ï¼š

```
è®¿é—®åœ°å€:
  - H5ç”¨æˆ·ç«¯: http://your-server-ip:5175
  - ç®¡ç†åå°: http://your-server-ip:5176
  - APIæ–‡æ¡£:  http://your-server-ip:3001/api-docs

é»˜è®¤ç®¡ç†å‘˜è´¦å·:
  ç”¨æˆ·å: admin
  å¯†ç : admin123
```

ç›´æ¥ç”¨æµè§ˆå™¨æ‰“å¼€å°±å¯ä»¥ä½¿ç”¨äº†ï¼

---

## ç®¡ç†å®ä¾‹

### æŸ¥çœ‹æ‰€æœ‰å®ä¾‹

```bash
./manage-instances.sh list
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
[1] score-system
    æè¿°: é»˜è®¤å®ä¾‹
    ç«¯å£: Backend=3000 H5=5173 Admin=5174

[2] score-system-instance2
    æè¿°: å®¢æˆ·Aç³»ç»Ÿ
    ç«¯å£: Backend=3001 H5=5175 Admin=5176

[3] score-system-instance3
    æè¿°: æµ‹è¯•ç¯å¢ƒ
    ç«¯å£: Backend=3002 H5=5177 Admin=5178
```

### æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

```bash
./manage-instances.sh status
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
./manage-instances.sh logs instance2

# åªçœ‹åç«¯æ—¥å¿—
./manage-instances.sh logs instance2 backend
```

### é‡å¯å®ä¾‹

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
./manage-instances.sh restart instance2

# åªé‡å¯åç«¯
./manage-instances.sh restart instance2 backend
```

### åœæ­¢/å¯åŠ¨å®ä¾‹

```bash
# åœæ­¢
./manage-instances.sh stop instance2

# å¯åŠ¨
./manage-instances.sh start instance2
```

---

## å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: ä¸ºæ–°å®¢æˆ·å¿«é€Ÿéƒ¨ç½²

```bash
# 1. åˆ›å»ºæ–°å®ä¾‹
./create-instance.sh client_abc "ABCå…¬å¸ç³»ç»Ÿ"

# 2. æŸ¥çœ‹è®¿é—®ä¿¡æ¯
./create-instance.sh info client_abc

# 3. å‘é€ç»™å®¢æˆ·
# H5: http://your-server:5175
# ç®¡ç†åå°: http://your-server:5176
# è´¦å·: admin / admin123
```

### åœºæ™¯2: æ­å»ºæµ‹è¯•ç¯å¢ƒ

```bash
# åˆ›å»ºæµ‹è¯•å®ä¾‹
./create-instance.sh test "æµ‹è¯•ç¯å¢ƒ"

# æµ‹è¯•å®Œæˆååˆ é™¤
cd /root/score-system-test
docker-compose down -v
cd /root
rm -rf score-system-test
```

### åœºæ™¯3: å®šæœŸå¤‡ä»½æ‰€æœ‰å®ä¾‹

```bash
# æ‰‹åŠ¨å¤‡ä»½
./manage-instances.sh backup-all

# è®¾ç½®æ¯å¤©è‡ªåŠ¨å¤‡ä»½ï¼ˆæ·»åŠ åˆ° crontabï¼‰
echo "0 2 * * * cd /root/score-system && ./manage-instances.sh backup-all" | crontab -
```

### åœºæ™¯4: æ‰¹é‡æ›´æ–°æ‰€æœ‰å®ä¾‹

```bash
# æ›´æ–°æ‰€æœ‰å®ä¾‹åˆ°æœ€æ–°ç‰ˆæœ¬
./manage-instances.sh update-all
```

---

## ç«¯å£åˆ†é…å‚è€ƒ

| å®ä¾‹ | MySQL | Redis | Backend | H5 | Admin |
|------|-------|-------|---------|-----|-------|
| é»˜è®¤ | 3307 | 6380 | 3000 | 5173 | 5174 |
| instance2 | 3308 | 6381 | 3001 | 5175 | 5176 |
| instance3 | 3309 | 6382 | 3002 | 5177 | 5178 |
| instance4 | 3310 | 6383 | 3003 | 5179 | 5180 |
| instance5 | 3311 | 6384 | 3004 | 5181 | 5182 |

**è§„å¾‹**ï¼šæ¯ä¸ªæ–°å®ä¾‹ç«¯å£ä¾æ¬¡é€’å¢

---

## ä½¿ç”¨åŸŸåè®¿é—®ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸æƒ³ç”¨ç«¯å£è®¿é—®ï¼Œå¯ä»¥é…ç½®åŸŸåï¼š

### 1. é…ç½®DNSè§£æ

åœ¨åŸŸåæ§åˆ¶å°æ·»åŠ Aè®°å½•ï¼š
- `client-a.yourdomain.com` â†’ `æœåŠ¡å™¨IP`
- `admin-a.yourdomain.com` â†’ `æœåŠ¡å™¨IP`

### 2. é…ç½®Nginx

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo vim /etc/nginx/sites-available/score-client-a

# æ·»åŠ å†…å®¹ï¼š
server {
    listen 80;
    server_name client-a.yourdomain.com;
    
    location / {
        proxy_pass http://localhost:5175;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /api {
        proxy_pass http://localhost:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

server {
    listen 80;
    server_name admin-a.yourdomain.com;
    
    location / {
        proxy_pass http://localhost:5176;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    location /api {
        proxy_pass http://localhost:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/score-client-a /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 3. é…ç½®HTTPSï¼ˆæ¨èï¼‰

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d client-a.yourdomain.com -d admin-a.yourdomain.com
```

ç°åœ¨å¯ä»¥ç”¨åŸŸåè®¿é—®äº†ï¼š
- https://client-a.yourdomain.com
- https://admin-a.yourdomain.com

---

## å¸¸è§é—®é¢˜

### Q: åˆ›å»ºå®ä¾‹å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œé€šå¸¸æ˜¯ï¼š

1. **ç«¯å£è¢«å ç”¨**ï¼š
```bash
# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep :5175

# ä¿®æ”¹ç«¯å£ï¼ˆç¼–è¾‘ .envï¼‰
vim /root/score-system-instance2/.env
```

2. **Docker æ²¡å¯åŠ¨**ï¼š
```bash
sudo systemctl start docker
```

3. **å†…å­˜ä¸è¶³**ï¼š
```bash
# æŸ¥çœ‹å†…å­˜
free -h

# æ¸…ç†Dockerç¼“å­˜
docker system prune -a
```

### Q: å¦‚ä½•æŸ¥çœ‹æ•°æ®åº“å¯†ç ï¼Ÿ

**A**: æŸ¥çœ‹å®ä¾‹çš„ `.env` æ–‡ä»¶

```bash
cat /root/score-system-instance2/.env | grep PASSWORD
```

### Q: å¦‚ä½•è¿æ¥åˆ°å®ä¾‹æ•°æ®åº“ï¼Ÿ

**A**: ä½¿ç”¨ MySQL å®¢æˆ·ç«¯

```bash
# æŸ¥çœ‹å¯†ç å’Œç«¯å£
cd /root/score-system-instance2
source .env
echo "MySQLç«¯å£: $MYSQL_PORT"
echo "ç”¨æˆ·: $MYSQL_USER"
echo "å¯†ç : $MYSQL_PASSWORD"
echo "æ•°æ®åº“: $MYSQL_DATABASE"

# è¿æ¥
mysql -h 127.0.0.1 -P $MYSQL_PORT -u $MYSQL_USER -p$MYSQL_PASSWORD $MYSQL_DATABASE
```

æˆ–ä½¿ç”¨å›¾å½¢åŒ–å·¥å…·ï¼ˆNavicatã€DBeaverç­‰ï¼‰ï¼Œè¿æ¥ä¿¡æ¯åŒä¸Šã€‚

### Q: æœåŠ¡å™¨èµ„æºå¤Ÿå—ï¼Ÿ

**A**: èµ„æºå‚è€ƒï¼š

- **æ¯ä¸ªå®ä¾‹éœ€è¦**ï¼š
  - CPU: 0.5-1æ ¸
  - å†…å­˜: 1-2GB
  - ç£ç›˜: 5-10GB

- **å»ºè®®é…ç½®**ï¼š
  - 2æ ¸4G: æœ€å¤š2ä¸ªå®ä¾‹
  - 4æ ¸8G: æœ€å¤š4ä¸ªå®ä¾‹
  - 8æ ¸16G: 6ä¸ªä»¥ä¸Šå®ä¾‹

æŸ¥çœ‹å½“å‰èµ„æºï¼š

```bash
# CPUå’Œå†…å­˜
./manage-instances.sh status

# ç£ç›˜
df -h
docker system df
```

---

## å®Œæ•´å‘½ä»¤é€ŸæŸ¥è¡¨

```bash
# åˆ›å»ºå®ä¾‹
./create-instance.sh <å®ä¾‹å> "<æè¿°>"

# æŸ¥çœ‹å®ä¾‹ä¿¡æ¯
./create-instance.sh info <å®ä¾‹å>

# åˆ—å‡ºæ‰€æœ‰å®ä¾‹
./create-instance.sh list
./manage-instances.sh list

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
./manage-instances.sh status

# æŸ¥çœ‹æ—¥å¿—
./manage-instances.sh logs <å®ä¾‹å> [æœåŠ¡å]

# é‡å¯
./manage-instances.sh restart <å®ä¾‹å> [æœåŠ¡å]

# å¯åŠ¨/åœæ­¢
./manage-instances.sh start <å®ä¾‹å>
./manage-instances.sh stop <å®ä¾‹å>

# æ›´æ–°
./manage-instances.sh update <å®ä¾‹å>
./manage-instances.sh update-all

# å¤‡ä»½
./manage-instances.sh backup <å®ä¾‹å>
./manage-instances.sh backup-all

# è¿›å…¥å®¹å™¨
cd /root/score-system-<å®ä¾‹å>
docker exec -it score-<å®ä¾‹å>-backend sh
```

---

## ä¸‹ä¸€æ­¥

- ğŸ“– è¯¦ç»†é…ç½®ï¼šå‚è€ƒ `å¤šå®ä¾‹éƒ¨ç½²æŒ‡å—.md`
- ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²ï¼šé€‚åˆç‰¹æ®Šéœ€æ±‚çš„åœºæ™¯
- ğŸ” å®‰å…¨åŠ å›ºï¼šä¿®æ”¹é»˜è®¤å¯†ç ã€é…ç½®é˜²ç«å¢™
- ğŸ“Š ç›‘æ§å‘Šè­¦ï¼šé›†æˆ Prometheus + Grafana
- ğŸ”„ è‡ªåŠ¨å¤‡ä»½ï¼šè®¾ç½®å®šæ—¶ä»»åŠ¡

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å®Œæ•´æ–‡æ¡£æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚





