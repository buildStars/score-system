#!/bin/bash

###############################################################################
# ç®¡ç†åå°ä¸€é”®éƒ¨ç½²è„šæœ¬
# ç”¨æ³•ï¼š./deploy-admin.sh
###############################################################################

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

echo "ğŸš€ å¼€å§‹éƒ¨ç½²ç®¡ç†åå°..."
echo "================================================"

# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd "$(dirname "$0")"
echo "ğŸ“ å½“å‰ç›®å½•: $(pwd)"

# 2. åœæ­¢æ—§å®¹å™¨
echo ""
echo "â¹ï¸  åœæ­¢æ—§å®¹å™¨..."
docker-compose down frontend-admin

# 3. æ„å»ºç®¡ç†åå°é•œåƒ
echo ""
echo "ğŸ”¨ æ„å»ºç®¡ç†åå°é•œåƒ..."
docker-compose build frontend-admin

# 4. å¯åŠ¨ç®¡ç†åå°æœåŠ¡
echo ""
echo "â–¶ï¸  å¯åŠ¨ç®¡ç†åå°æœåŠ¡..."
docker-compose up -d frontend-admin

# 5. ç­‰å¾…æœåŠ¡å¯åŠ¨
echo ""
echo "â³ ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆ3ç§’ï¼‰..."
sleep 3

# 6. æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo ""
echo "ğŸ” æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
docker-compose ps frontend-admin

# 7. æ˜¾ç¤ºè®¿é—®åœ°å€
echo ""
echo "âœ… ç®¡ç†åå°éƒ¨ç½²å®Œæˆï¼"
echo "================================================"
echo "ğŸŒ è®¿é—®åœ°å€ï¼š"
echo "   http://localhost:8081"
echo "   http://$(hostname -I | awk '{print $1}'):8081"
echo ""
echo "ğŸ“‹ æŸ¥çœ‹å®æ—¶æ—¥å¿—..."
echo "   ï¼ˆæŒ‰ Ctrl+C åœæ­¢æŸ¥çœ‹æ—¥å¿—ï¼Œä¸ä¼šåœæ­¢æœåŠ¡ï¼‰"
echo ""

docker-compose logs -f frontend-admin

