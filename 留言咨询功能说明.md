# 留言咨询功能说明

## ✅ 功能概述

用户可以在登录页面点击"有疑问？合作洽谈"入口，填写留言表单提交咨询，后台管理员可以查看、回复和管理所有留言。

---

## 🎯 功能特点

### 用户端（H5）
- ✅ 登录页底部添加"有疑问？合作洽谈"入口
- ✅ 无需登录即可提交留言
- ✅ 简洁美观的留言表单（姓名、联系方式、留言内容）
- ✅ 表单验证和字数限制
- ✅ 提交成功后自动返回登录页

### 管理端（Admin）
- ✅ 留言列表展示（分页、搜索、筛选）
- ✅ 按状态筛选：未读、已读、已回复
- ✅ 关键词搜索（姓名、联系方式、留言内容）
- ✅ 查看留言详情（点击自动标记为已读）
- ✅ 回复留言功能
- ✅ 删除/批量删除留言
- ✅ 实时显示未读留言数量

---

## 📋 数据库表结构

### `messages` 表

| 字段 | 类型 | 说明 |
|-----|------|------|
| id | INT | 主键ID |
| name | VARCHAR(50) | 用户姓名 |
| contact | VARCHAR(100) | 联系方式 |
| message | TEXT | 留言内容 |
| status | VARCHAR(20) | 状态（unread/read/replied） |
| admin_reply | TEXT | 管理员回复 |
| replied_at | DATETIME | 回复时间 |
| replied_by | INT | 回复管理员ID |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

---

## 🔌 API 接口

### 用户端接口

#### 1. 提交留言（无需登录）
```
POST /api/message/submit
```

**请求参数：**
```json
{
  "name": "张三",
  "contact": "13800138000",
  "message": "我想咨询合作相关事宜"
}
```

**响应：**
```json
{
  "code": 200,
  "message": "留言提交成功，我们会尽快与您联系",
  "data": { ... }
}
```

---

### 管理端接口（需要登录）

#### 1. 获取留言列表
```
GET /api/message/list?status=unread&keyword=张三&page=1&pageSize=20
```

#### 2. 查看留言详情（自动标记已读）
```
GET /api/message/:id
```

#### 3. 回复留言
```
POST /api/message/:id/reply
```

**请求参数：**
```json
{
  "adminReply": "感谢您的咨询，我们会尽快与您联系"
}
```

#### 4. 删除留言
```
DELETE /api/message/:id
```

#### 5. 批量删除
```
POST /api/message/batch-delete
```

**请求参数：**
```json
{
  "ids": [1, 2, 3]
}
```

#### 6. 获取未读数量
```
GET /api/message/unread-count
```

---

## 🎨 页面路由

### H5 用户端
- `/login` - 登录页（底部有咨询入口）
- `/contact-us` - 留言咨询页面

### Admin 管理端
- `/messages` - 留言管理页面

---

## 📝 使用流程

### 用户提交留言
1. 打开登录页 → 点击底部"有疑问？合作洽谈"
2. 填写姓名、联系方式、留言内容
3. 点击"提交留言"
4. 提示提交成功，自动返回登录页

### 管理员处理留言
1. 登录后台管理系统
2. 点击左侧菜单"留言管理"
3. 查看留言列表（未读留言会有红色标签）
4. 点击"查看"按钮查看详情（自动标记为已读）
5. 点击"回复"按钮填写回复内容
6. 提交回复后状态变为"已回复"
7. 可根据需要删除不需要的留言

---

## 🔔 状态说明

| 状态 | 说明 | 标签颜色 |
|-----|------|---------|
| unread | 未读 | 红色 |
| read | 已读 | 黄色 |
| replied | 已回复 | 绿色 |

---

## 💡 注意事项

1. **无需登录**：用户提交留言无需登录，方便潜在客户咨询
2. **自动已读**：管理员点击查看详情时，系统自动将状态从"未读"改为"已读"
3. **数据保密**：用户联系方式仅管理员可见
4. **字数限制**：
   - 姓名：最多 50 字符
   - 联系方式：最多 100 字符
   - 留言内容：最多 500 字符
   - 回复内容：最多 500 字符

---

## 🎉 完成！

留言咨询功能已全部实现，可以开始使用了！

