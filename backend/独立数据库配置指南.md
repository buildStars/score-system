# ğŸ—„ï¸ ç‹¬ç«‹æ•°æ®åº“é…ç½®æŒ‡å—

## ç›®çš„

ä¸ºè®¡åˆ†ç³»ç»Ÿåˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œé¿å…å’Œå…¶ä»–é¡¹ç›®ï¼ˆç‰¹åˆ«æ˜¯Dockeréƒ¨ç½²çš„é¡¹ç›®ï¼‰çš„æ•°æ®åº“äº§ç”Ÿå†²çªæˆ–æ±¡æŸ“ã€‚

---

## æ–¹æ¡ˆä¸€ï¼šåˆ›å»ºç‹¬ç«‹çš„MySQLæ•°æ®åº“ï¼ˆæ¨èï¼‰

### ç¬¬1æ­¥ï¼šè¿æ¥MySQL

```bash
mysql -u root -p
```

### ç¬¬2æ­¥ï¼šåˆ›å»ºç‹¬ç«‹æ•°æ®åº“

```sql
-- åˆ›å»ºç‹¬ç«‹çš„æ•°æ®åº“ï¼ˆä½¿ç”¨ç‰¹æ®Šåç§°ï¼‰
CREATE DATABASE score_system_new CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- æˆ–è€…ä½¿ç”¨æ›´æ˜ç¡®çš„åç§°
CREATE DATABASE yunce_score_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ï¼Œç¡®è®¤åˆ›å»ºæˆåŠŸ
SHOW DATABASES;
```

### ç¬¬3æ­¥ï¼šåˆ›å»ºç‹¬ç«‹çš„æ•°æ®åº“ç”¨æˆ·ï¼ˆæ¨èï¼Œæ›´å®‰å…¨ï¼‰

```sql
-- åˆ›å»ºä¸“ç”¨ç”¨æˆ·
CREATE USER 'score_user'@'localhost' IDENTIFIED BY 'score_password_2024';

-- æˆäºˆè¯¥ç”¨æˆ·å¯¹è®¡åˆ†ç³»ç»Ÿæ•°æ®åº“çš„æ‰€æœ‰æƒé™
GRANT ALL PRIVILEGES ON yunce_score_system.* TO 'score_user'@'localhost';

-- åˆ·æ–°æƒé™
FLUSH PRIVILEGES;

-- é€€å‡º
EXIT;
```

### ç¬¬4æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `backend/.env` æ–‡ä»¶ï¼š

```env
# ä½¿ç”¨ç‹¬ç«‹æ•°æ®åº“å’Œä¸“ç”¨ç”¨æˆ·
DATABASE_URL="mysql://score_user:score_password_2024@localhost:3306/yunce_score_system"

# æˆ–è€…ä½¿ç”¨rootç”¨æˆ·ï¼ˆä¸æ¨èï¼‰
# DATABASE_URL="mysql://root:your_password@localhost:3306/yunce_score_system"

# å…¶ä»–é…ç½®ä¿æŒä¸å˜
JWT_SECRET="your-secret-key-please-change"
JWT_EXPIRES_IN="7d"
JWT_ADMIN_EXPIRES_IN="12h"
PORT=3000
NODE_ENV="development"
CORS_ORIGIN="http://localhost:5173,http://localhost:5174"
```

### ç¬¬5æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“

```bash
cd score-system/backend

# ç”ŸæˆPrisma Client
npx prisma generate

# è¿è¡Œè¿ç§»ï¼ˆä¼šåœ¨æ–°æ•°æ®åº“ä¸­åˆ›å»ºè¡¨ï¼‰
npx prisma migrate dev --name init

# åˆå§‹åŒ–ç§å­æ•°æ®
npx prisma db seed
```

### ç¬¬6æ­¥ï¼šéªŒè¯

```bash
# è¿æ¥åˆ°æ–°æ•°æ®åº“
mysql -u score_user -p yunce_score_system

# æŸ¥çœ‹è¡¨
SHOW TABLES;

# åº”è¯¥çœ‹åˆ°8å¼ è¡¨ï¼š
# - users
# - bets
# - lottery_results
# - point_records
# - bet_settings
# - system_settings
# - admins
# - admin_logs
```

---

## æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ä¸åŒçš„MySQLç«¯å£

å¦‚æœä½ çš„Dockeré¡¹ç›®ä½¿ç”¨äº†MySQLçš„3306ç«¯å£ï¼Œå¯ä»¥åœ¨æœ¬åœ°å†å¯åŠ¨ä¸€ä¸ªMySQLå®ä¾‹ä½¿ç”¨ä¸åŒç«¯å£ã€‚

### ä½¿ç”¨Dockerå¯åŠ¨ç‹¬ç«‹MySQL

```bash
# å¯åŠ¨ä¸€ä¸ªç‹¬ç«‹çš„MySQLå®¹å™¨ï¼Œä½¿ç”¨3307ç«¯å£
docker run -d \
  --name score-mysql \
  -p 3307:3306 \
  -e MYSQL_ROOT_PASSWORD=score_root_password \
  -e MYSQL_DATABASE=score_system \
  -e MYSQL_USER=score_user \
  -e MYSQL_PASSWORD=score_password \
  -v score-mysql-data:/var/lib/mysql \
  mysql:8.0

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep score-mysql

# æŸ¥çœ‹æ—¥å¿—
docker logs score-mysql
```

### é…ç½®ç¯å¢ƒå˜é‡

```env
# ä½¿ç”¨3307ç«¯å£çš„ç‹¬ç«‹MySQL
DATABASE_URL="mysql://score_user:score_password@localhost:3307/score_system"
```

### åˆå§‹åŒ–æ•°æ®åº“

```bash
cd score-system/backend
npx prisma generate
npx prisma migrate dev --name init
npx prisma db seed
```

---

## æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨Docker Composeï¼ˆå®Œå…¨éš”ç¦»ï¼‰

### åˆ›å»ºç‹¬ç«‹çš„Docker Composeé…ç½®

åˆ›å»º `score-system/docker-compose.dev.yml`ï¼š

```yaml
version: '3.8'

services:
  # ç‹¬ç«‹çš„MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: score-system-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: score_root_2024
      MYSQL_DATABASE: score_system
      MYSQL_USER: score_user
      MYSQL_PASSWORD: score_pass_2024
    ports:
      - "3307:3306"  # ä½¿ç”¨3307é¿å…å†²çª
    volumes:
      - score-mysql-data:/var/lib/mysql
    networks:
      - score-network

  # Redisï¼ˆå¯é€‰ï¼‰
  redis:
    image: redis:7-alpine
    container_name: score-system-redis
    restart: always
    ports:
      - "6380:6379"  # ä½¿ç”¨6380é¿å…å†²çª
    volumes:
      - score-redis-data:/data
    networks:
      - score-network

volumes:
  score-mysql-data:
    name: score-mysql-data
  score-redis-data:
    name: score-redis-data

networks:
  score-network:
    name: score-network
    driver: bridge
```

### å¯åŠ¨ç‹¬ç«‹çš„æ•°æ®åº“æœåŠ¡

```bash
cd score-system

# å¯åŠ¨æ•°æ®åº“æœåŠ¡
docker-compose -f docker-compose.dev.yml up -d

# æŸ¥çœ‹çŠ¶æ€
docker-compose -f docker-compose.dev.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.dev.yml logs -f mysql
```

### é…ç½®ç¯å¢ƒå˜é‡

```env
DATABASE_URL="mysql://score_user:score_pass_2024@localhost:3307/score_system"
REDIS_HOST="localhost"
REDIS_PORT=6380
```

### åœæ­¢æœåŠ¡

```bash
# åœæ­¢æœåŠ¡
docker-compose -f docker-compose.dev.yml down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
docker-compose -f docker-compose.dev.yml down -v
```

---

## æ¨èæ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **æ–¹æ¡ˆä¸€ï¼šç‹¬ç«‹æ•°æ®åº“** | âœ… ç®€å•ç›´æ¥<br>âœ… ä½¿ç”¨ç°æœ‰MySQL<br>âœ… æ— éœ€é¢å¤–èµ„æº | âš ï¸ å…±äº«MySQLå®ä¾‹ | å¼€å‘ç¯å¢ƒï¼Œå·²æœ‰MySQL |
| **æ–¹æ¡ˆäºŒï¼šç‹¬ç«‹ç«¯å£** | âœ… å®Œå…¨ç‹¬ç«‹<br>âœ… æ˜“äºæ¸…ç† | âš ï¸ éœ€è¦Docker<br>âš ï¸ å ç”¨é¢å¤–èµ„æº | éœ€è¦å®Œå…¨éš”ç¦» |
| **æ–¹æ¡ˆä¸‰ï¼šDocker Compose** | âœ… å®Œå…¨éš”ç¦»<br>âœ… åŒ…å«Redis<br>âœ… å¯é‡å¤éƒ¨ç½² | âš ï¸ é…ç½®å¤æ‚<br>âš ï¸ èµ„æºå ç”¨å¤š | ç”Ÿäº§ç¯å¢ƒæ¨¡æ‹Ÿ |

---

## æ¨èé…ç½®

### âœ… æœ€ç®€å•æ–¹æ¡ˆï¼ˆæ¨èï¼‰

**åˆ›å»ºç‹¬ç«‹æ•°æ®åº“åç§°ï¼š**

```sql
CREATE DATABASE yunce_score_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

**`.env` é…ç½®ï¼š**

```env
DATABASE_URL="mysql://root:your_password@localhost:3306/yunce_score_system"
```

è¿™æ ·å¯ä»¥ï¼š
- âœ… å’Œä½ çš„Dockeré¡¹ç›®å®Œå…¨ç‹¬ç«‹
- âœ… æ•°æ®åº“åç§°æ¸…æ™°æ˜äº†ï¼ˆ`yunce_score_system`ï¼‰
- âœ… ä¸éœ€è¦é¢å¤–çš„Dockerå®¹å™¨
- âœ… ä¾¿äºç®¡ç†å’Œå¤‡ä»½

---

## éªŒè¯ç‹¬ç«‹æ€§

### æ£€æŸ¥æ•°æ®åº“åˆ—è¡¨

```bash
mysql -u root -p -e "SHOW DATABASES;"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
+----------------------+
| Database             |
+----------------------+
| your_docker_db       |  <- ä½ çš„Dockeré¡¹ç›®æ•°æ®åº“
| yunce_score_system   |  <- æ–°çš„è®¡åˆ†ç³»ç»Ÿæ•°æ®åº“
| ...                  |
+----------------------+
```

### æ£€æŸ¥è¡¨ç»“æ„

```bash
# æŸ¥çœ‹è®¡åˆ†ç³»ç»Ÿçš„è¡¨
mysql -u root -p yunce_score_system -e "SHOW TABLES;"

# åº”è¯¥çœ‹åˆ°8å¼ è¡¨
+-------------------------------+
| Tables_in_yunce_score_system  |
+-------------------------------+
| admins                        |
| admin_logs                    |
| bets                          |
| bet_settings                  |
| lottery_results               |
| point_records                 |
| system_settings               |
| users                         |
+-------------------------------+
```

---

## æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤

### å¤‡ä»½æ•°æ®åº“

```bash
# å¤‡ä»½æ•´ä¸ªæ•°æ®åº“
mysqldump -u root -p yunce_score_system > backup_$(date +%Y%m%d).sql

# å¤‡ä»½åˆ°æŒ‡å®šç›®å½•
mysqldump -u root -p yunce_score_system > score-system/backups/backup_$(date +%Y%m%d).sql
```

### æ¢å¤æ•°æ®åº“

```bash
# æ¢å¤æ•°æ®åº“
mysql -u root -p yunce_score_system < backup_20241126.sql
```

### å®šæœŸå¤‡ä»½è„šæœ¬

åˆ›å»º `score-system/scripts/backup.sh`ï¼š

```bash
#!/bin/bash

# é…ç½®
DB_NAME="yunce_score_system"
DB_USER="root"
BACKUP_DIR="./backups"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
mysqldump -u $DB_USER -p $DB_NAME > $BACKUP_DIR/score_system_$DATE.sql

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "score_system_*.sql" -mtime +7 -delete

echo "âœ… æ•°æ®åº“å¤‡ä»½å®Œæˆ: $BACKUP_DIR/score_system_$DATE.sql"
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ç¡®è®¤æ²¡æœ‰æ±¡æŸ“å…¶ä»–æ•°æ®åº“ï¼Ÿ

A: ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“åç§°ï¼ˆå¦‚ `yunce_score_system`ï¼‰ï¼Œå®Œå…¨ä¸ä¼šå½±å“å…¶ä»–æ•°æ®åº“ã€‚

### Q2: å¯ä»¥åˆ é™¤æµ‹è¯•æ•°æ®é‡æ–°å¼€å§‹å—ï¼Ÿ

A: å¯ä»¥ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# åˆ é™¤æ‰€æœ‰è¡¨
npx prisma migrate reset

# é‡æ–°åˆ›å»ºè¡¨å’Œç§å­æ•°æ®
npx prisma migrate dev --name init
npx prisma db seed
```

### Q3: å¦‚ä½•å½»åº•åˆ é™¤è®¡åˆ†ç³»ç»Ÿæ•°æ®åº“ï¼Ÿ

A: 
```sql
DROP DATABASE yunce_score_system;
```

### Q4: Dockeré¡¹ç›®å’Œè¿™ä¸ªé¡¹ç›®å¯ä»¥åŒæ—¶è¿è¡Œå—ï¼Ÿ

A: å¯ä»¥ï¼åªè¦ï¼š
- ä½¿ç”¨ä¸åŒçš„æ•°æ®åº“åç§° âœ…
- ä½¿ç”¨ä¸åŒçš„ç«¯å£ï¼ˆåç«¯APIç«¯å£ï¼‰âœ…

---

## å¿«é€Ÿé…ç½®æ­¥éª¤ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. åˆ›å»ºæ•°æ®åº“
mysql -u root -p -e "CREATE DATABASE yunce_score_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# 2. é…ç½®ç¯å¢ƒå˜é‡
cd score-system/backend
echo 'DATABASE_URL="mysql://root:your_password@localhost:3306/yunce_score_system"' > .env
# ç„¶åæ‰‹åŠ¨è¡¥å……å…¶ä»–ç¯å¢ƒå˜é‡

# 3. åˆå§‹åŒ–æ•°æ®åº“
npx prisma generate
npx prisma migrate dev --name init
npx prisma db seed

# 4. å¯åŠ¨æœåŠ¡
pnpm start:dev

# 5. éªŒè¯
curl http://localhost:3000/api-docs
```

---

## æ€»ç»“

âœ… **æ¨èæ–¹æ¡ˆ**ï¼šåˆ›å»ºç‹¬ç«‹æ•°æ®åº“ `yunce_score_system`

âœ… **ä¼˜ç‚¹**ï¼š
- å®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¼šæ±¡æŸ“å…¶ä»–æ•°æ®åº“
- é…ç½®ç®€å•ï¼Œæ— éœ€é¢å¤–æœåŠ¡
- æ˜“äºç®¡ç†å’Œå¤‡ä»½
- å¯ä»¥éšæ—¶åˆ é™¤é‡å»º

âœ… **å®‰å…¨æ€§**ï¼š
- ä½¿ç”¨ä¸“ç”¨æ•°æ®åº“ç”¨æˆ·
- è®¾ç½®å¼ºå¯†ç 
- å®šæœŸå¤‡ä»½

---

**åˆ›å»ºæ—¥æœŸ**ï¼š2024å¹´11æœˆ26æ—¥  
**æ•°æ®åº“åç§°**ï¼š`yunce_score_system`ï¼ˆæ¨èï¼‰  
**å®Œå…¨ç‹¬ç«‹**ï¼šâœ… ä¸ä¼šå½±å“å…¶ä»–é¡¹ç›®



