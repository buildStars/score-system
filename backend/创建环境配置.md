# 🔧 创建环境配置文件

## 快速创建 .env 文件

### 方法一：使用命令行（推荐）

在 `backend` 目录下执行：

**Windows PowerShell:**
```powershell
Copy-Item .env.example .env
```

**Windows CMD:**
```cmd
copy .env.example .env
```

**Linux/Mac:**
```bash
cp .env.example .env
```

### 方法二：手动创建

1. 在 `backend` 目录下创建一个新文件，命名为 `.env`
2. 复制下面的内容粘贴进去
3. 根据实际情况修改配置

---

## .env 文件内容

```env
# ============================================
# 计分系统后端环境配置文件
# ============================================

# ==================== 数据库配置 ====================
DATABASE_URL="mysql://root:123456@localhost:3306/score_system"

# ==================== 服务器配置 ====================
PORT=3000
NODE_ENV=development

# ==================== JWT 认证配置 ====================
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-2024
JWT_EXPIRES_IN=7d

# ==================== 开奖数据源配置 ====================
LOTTERY_API_URL=http://localhost:8081/userApi/Lott
LOTTERY_SYNC_INTERVAL=5

# ==================== Redis 配置（可选）====================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# ==================== 管理员配置 ====================
ADMIN_USERNAME=admin
ADMIN_DEFAULT_PASSWORD=admin123
ADMIN_REAL_NAME=系统管理员

# ==================== 日志配置 ====================
LOG_LEVEL=info
LOG_MAX_FILES=30d

# ==================== 跨域配置 ====================
CORS_ORIGIN=http://localhost:5174,http://localhost:5173

# ==================== 限流配置 ====================
THROTTLE_TTL=60
THROTTLE_LIMIT=100
```

---

## 📝 配置说明

### 1. 数据库配置 ⚙️

```env
DATABASE_URL="mysql://用户名:密码@主机:端口/数据库名"
```

**示例：**
- 本地开发：`mysql://root:123456@localhost:3306/score_system`
- 远程数据库：`mysql://admin:MyPass123@192.168.1.100:3306/score_system`

**创建数据库：**
```sql
CREATE DATABASE score_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. JWT 密钥 🔐

```env
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-2024
```

**⚠️ 重要：生产环境必须修改为复杂的随机字符串！**

**生成随机密钥（推荐）：**
```bash
# Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# 或在浏览器控制台
Array.from(crypto.getRandomValues(new Uint8Array(32))).map(b => b.toString(16).padStart(2, '0')).join('')
```

### 3. 管理员配置 👤

```env
ADMIN_USERNAME=admin
ADMIN_DEFAULT_PASSWORD=admin123
```

**首次运行时会自动创建此管理员账号**

### 4. 开奖数据源 🎰

```env
LOTTERY_API_URL=http://localhost:8081/userApi/Lott
```

**如果没有外部开奖数据源，可以使用模拟数据**

### 5. Redis 配置（可选）📦

```env
REDIS_HOST=localhost
REDIS_PORT=6379
```

**如果不使用 Redis，可以不配置或留空**

---

## ✅ 配置检查清单

创建完 `.env` 文件后，请检查：

- [ ] 数据库连接信息是否正确
- [ ] JWT_SECRET 是否已修改（生产环境）
- [ ] 管理员密码是否设置
- [ ] 端口是否被占用
- [ ] 数据库是否已创建

---

## 🚀 下一步操作

### 1. 初始化数据库

```bash
# 运行数据库迁移
npx prisma migrate dev --name init

# 生成 Prisma Client
npx prisma generate
```

### 2. 启动后端服务

```bash
npm run start:dev
```

### 3. 验证服务

访问：http://localhost:3000

---

## 🐛 常见问题

### 问题1：数据库连接失败

**错误信息：**
```
Error: P1001: Can't reach database server
```

**解决方案：**
1. 检查 MySQL 服务是否启动
2. 检查数据库地址、端口、用户名、密码
3. 检查防火墙设置
4. 确认数据库已创建

### 问题2：.env 文件不生效

**解决方案：**
1. 确认文件名为 `.env`（不是 `.env.txt`）
2. 确认文件在 `backend` 目录下
3. 重启后端服务

### 问题3：JWT 认证失败

**解决方案：**
1. 检查 JWT_SECRET 是否配置
2. 检查 JWT_EXPIRES_IN 格式是否正确
3. 清除浏览器缓存和 Token

---

## 📚 更多信息

- [Prisma 文档](https://www.prisma.io/docs/)
- [NestJS 配置](https://docs.nestjs.com/techniques/configuration)
- [环境变量最佳实践](https://12factor.net/config)

---

**配置完成后记得重启后端服务！** 🎉





