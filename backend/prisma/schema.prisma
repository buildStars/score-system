generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int           @id @default(autoincrement()) @db.UnsignedInt
  username     String        @unique @db.VarChar(50)
  password     String        @db.VarChar(255)
  nickname     String?       @db.VarChar(50)
  points       Int           @default(0) @db.Int
  status       Int           @default(1) @db.TinyInt
  lastLoginAt  DateTime?     @map("last_login_at")
  lastLoginIp  String?       @map("last_login_ip") @db.VarChar(50)
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  bets         Bet[]
  pointRecords PointRecord[]

  @@index([status], map: "idx_status")
  @@index([createdAt], map: "idx_created_at")
  @@map("users")
}

model Admin {
  id          Int        @id @default(autoincrement()) @db.UnsignedInt
  username    String     @unique @db.VarChar(50)
  password    String     @db.VarChar(255)
  realName    String?    @map("real_name") @db.VarChar(50)
  role        String     @default("admin") @db.VarChar(20)
  status      Int        @default(1) @db.TinyInt
  lastLoginAt DateTime?  @map("last_login_at")
  lastLoginIp String?    @map("last_login_ip") @db.VarChar(50)
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  logs        AdminLog[]

  @@index([role], map: "idx_role")
  @@index([status], map: "idx_status")
  @@map("admins")
}

model LotteryResult {
  id            Int       @id @default(autoincrement()) @db.UnsignedInt
  issue         String    @unique @db.VarChar(50)
  number1       Int       @db.TinyInt
  number2       Int       @db.TinyInt
  number3       Int       @db.TinyInt
  resultSum     Int       @map("result_sum") @db.TinyInt
  isReturn      Int       @map("is_return") @db.TinyInt
  returnReason  String?   @map("return_reason") @db.VarChar(50)
  sizeResult    String    @map("size_result") @db.VarChar(10)
  oddEvenResult String    @map("odd_even_result") @db.VarChar(10)
  comboResult   String    @map("combo_result") @db.VarChar(10)
  drawTime      DateTime  @map("draw_time")
  isSettled     Int       @default(0) @map("is_settled") @db.TinyInt
  settledAt     DateTime? @map("settled_at")
  createdAt     DateTime  @default(now()) @map("created_at")

  @@index([drawTime], map: "idx_draw_time")
  @@index([isSettled], map: "idx_is_settled")
  @@index([resultSum], map: "idx_result_sum")
  @@map("lottery_results")
}

model Bet {
  id           BigInt    @id @default(autoincrement()) @db.UnsignedBigInt
  userId       Int       @map("user_id") @db.UnsignedInt
  issue        String    @db.VarChar(50)
  betType      String    @map("bet_type") @db.VarChar(20)
  betContent   String    @map("bet_content") @db.VarChar(50)
  amount       Int       @db.Int
  fee          Int       @default(0) @db.Int
  status       String    @default("pending") @db.VarChar(20)
  resultAmount Int?      @map("result_amount") @db.Int
  pointsBefore Int       @map("points_before") @db.Int
  pointsAfter  Int?      @map("points_after") @db.Int
  settledAt    DateTime? @map("settled_at")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "idx_user_id")
  @@index([issue], map: "idx_issue")
  @@index([status], map: "idx_status")
  @@index([createdAt], map: "idx_created_at")
  @@index([userId, issue], map: "idx_user_issue")
  @@map("bets")
}

model PointRecord {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  userId        Int      @map("user_id") @db.UnsignedInt
  type          String   @db.VarChar(20)
  amount        Decimal  @db.Decimal(10, 2)
  balanceBefore Decimal  @map("balance_before") @db.Decimal(10, 2)
  balanceAfter  Decimal  @map("balance_after") @db.Decimal(10, 2)
  relatedId     BigInt?  @map("related_id") @db.UnsignedBigInt
  relatedType   String?  @map("related_type") @db.VarChar(20)
  remark        String?  @db.VarChar(255)
  operatorId    Int?     @map("operator_id") @db.UnsignedInt
  operatorType  String?  @map("operator_type") @db.VarChar(20)
  createdAt     DateTime @default(now()) @map("created_at")
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "idx_user_id")
  @@index([type], map: "idx_type")
  @@index([createdAt], map: "idx_created_at")
  @@index([userId, createdAt], map: "idx_user_created")
  @@map("point_records")
}

model BetSetting {
  id           Int      @id @default(autoincrement()) @db.UnsignedInt
  settingKey   String   @unique @map("setting_key") @db.VarChar(50)
  settingValue String   @map("setting_value") @db.VarChar(255)
  settingName  String   @map("setting_name") @db.VarChar(100)
  description  String?  @db.VarChar(255)
  valueType    String   @default("string") @map("value_type") @db.VarChar(20)
  updatedAt    DateTime @updatedAt @map("updated_at")
  createdAt    DateTime @default(now()) @map("created_at")

  @@map("bet_settings")
}

model SystemSetting {
  id           Int      @id @default(autoincrement()) @db.UnsignedInt
  settingKey   String   @unique @map("setting_key") @db.VarChar(50)
  settingValue String   @map("setting_value") @db.Text
  settingName  String   @map("setting_name") @db.VarChar(100)
  description  String?  @db.VarChar(255)
  valueType    String   @default("string") @map("value_type") @db.VarChar(20)
  updatedAt    DateTime @updatedAt @map("updated_at")
  createdAt    DateTime @default(now()) @map("created_at")

  @@map("system_settings")
}

model BetTypeSetting {
  id          Int      @id @default(autoincrement())
  betType     String   @unique @map("bet_type") @db.VarChar(50)
  name        String   @db.VarChar(100)
  odds        Decimal  @default(0.00) @db.Decimal(10, 2)
  minBet      Decimal  @default(1.00) @map("min_bet") @db.Decimal(10, 2)
  maxBet      Decimal  @default(10000.00) @map("max_bet") @db.Decimal(10, 2)
  feeRate     Decimal  @default(0.0000) @map("fee_rate") @db.Decimal(10, 4)
  isEnabled   Boolean  @default(true) @map("is_enabled")
  sortOrder   Int      @default(0) @map("sort_order")
  description String?  @db.VarChar(500)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  @@map("bet_type_settings")
}

model AdminLog {
  id            BigInt   @id @default(autoincrement()) @db.UnsignedBigInt
  adminId       Int      @map("admin_id") @db.UnsignedInt
  adminUsername String   @map("admin_username") @db.VarChar(50)
  action        String   @db.VarChar(50)
  resourceType  String?  @map("resource_type") @db.VarChar(50)
  resourceId    String?  @map("resource_id") @db.VarChar(50)
  description   String   @db.VarChar(255)
  ipAddress     String?  @map("ip_address") @db.VarChar(50)
  userAgent     String?  @map("user_agent") @db.VarChar(255)
  requestData   Json?    @map("request_data")
  createdAt     DateTime @default(now()) @map("created_at")
  admin         Admin    @relation(fields: [adminId], references: [id])

  @@index([adminId], map: "idx_admin_id")
  @@index([action], map: "idx_action")
  @@index([createdAt], map: "idx_created_at")
  @@index([adminId, createdAt], map: "idx_admin_created")
  @@map("admin_logs")
}
