# ğŸš€ åç«¯å¿«é€Ÿå¯åŠ¨æŒ‡å—

## âœ… å½“å‰çŠ¶æ€

**å·²å®Œæˆæ¨¡å—**ï¼š
- âœ… è®¤è¯æ¨¡å—ï¼ˆç”¨æˆ·ç™»å½•ã€ç®¡ç†å‘˜ç™»å½•ï¼‰
- âœ… ç”¨æˆ·æ¨¡å—ï¼ˆç”¨æˆ·ç®¡ç†ã€ç§¯åˆ†è°ƒæ•´ï¼‰
- âœ… ä¸‹æ³¨æ¨¡å—ï¼ˆæäº¤ä¸‹æ³¨ã€æŸ¥è¯¢è®°å½•ï¼‰
- âœ… æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆå›æœ¬åˆ¤å®šã€ç»“ç®—è®¡ç®—ï¼‰

**å¯ç”¨çš„APIæ¥å£**ï¼š13ä¸ªæ ¸å¿ƒæ¥å£å·²å°±ç»ªï¼

---

## ğŸ¯ 10åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨

### ç¬¬1æ­¥ï¼šå®‰è£…ä¾èµ–ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
cd score-system/backend
pnpm install
```

### ç¬¬2æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ1åˆ†é’Ÿï¼‰

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL="mysql://root:your_password@localhost:3306/score_system"

# Redisé…ç½®
REDIS_HOST="localhost"
REDIS_PORT=6379
REDIS_PASSWORD=""

# JWTé…ç½®
JWT_SECRET="your-secret-key-please-change-this"
JWT_EXPIRES_IN="7d"
JWT_ADMIN_EXPIRES_IN="12h"

# åº”ç”¨é…ç½®
PORT=3000
NODE_ENV="development"

# CORSé…ç½®
CORS_ORIGIN="http://localhost:5173,http://localhost:5174"
```

### ç¬¬3æ­¥ï¼šåˆ›å»ºæ•°æ®åº“ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
mysql -u root -p
```

```sql
CREATE DATABASE score_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

### ç¬¬4æ­¥ï¼šæ•°æ®åº“è¿ç§»ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
# ç”ŸæˆPrisma Client
npx prisma generate

# åˆ›å»ºæ•°æ®åº“è¡¨
npx prisma migrate dev --name init

# åˆå§‹åŒ–ç§å­æ•°æ®
npx prisma db seed
```

### ç¬¬5æ­¥ï¼šå¯åŠ¨æœåŠ¡å™¨ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
pnpm start:dev
```

çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºæˆåŠŸï¼š
```
ğŸš€ åº”ç”¨å¯åŠ¨æˆåŠŸï¼
ğŸ“¡ APIåœ°å€: http://localhost:3000/api
ğŸ“š APIæ–‡æ¡£: http://localhost:3000/api-docs
```

### ç¬¬6æ­¥ï¼šæµ‹è¯•APIï¼ˆ3åˆ†é’Ÿï¼‰

#### æµ‹è¯•1ï¼šç”¨æˆ·ç™»å½•
```bash
curl -X POST http://localhost:3000/api/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"user001","password":"123456"}'
```

æˆåŠŸå“åº”ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "user": {
      "id": 1,
      "username": "user001",
      "nickname": "æµ‹è¯•ç”¨æˆ·1",
      "points": 5000
    },
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "expiresIn": 604800
  }
}
```

#### æµ‹è¯•2ï¼šç®¡ç†å‘˜ç™»å½•
```bash
curl -X POST http://localhost:3000/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

#### æµ‹è¯•3ï¼šè·å–ç”¨æˆ·ä¿¡æ¯
```bash
# ä½¿ç”¨ç™»å½•è¿”å›çš„token
curl http://localhost:3000/api/user/info \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

#### æµ‹è¯•4ï¼šæäº¤ä¸‹æ³¨
```bash
curl -X POST http://localhost:3000/api/user/bet \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -d '{
    "issue": "3330421",
    "betType": "multiple",
    "betContent": "1000",
    "amount": 1000
  }'
```

---

## ğŸ“– è®¿é—®Swaggeræ–‡æ¡£

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š**http://localhost:3000/api-docs**

åœ¨è¿™é‡Œå¯ä»¥ï¼š
- æŸ¥çœ‹æ‰€æœ‰å¯ç”¨API
- åœ¨çº¿æµ‹è¯•æ¥å£
- æŸ¥çœ‹è¯·æ±‚å“åº”æ ¼å¼

---

## ğŸ® æµ‹è¯•æ•°æ®

### é»˜è®¤ç®¡ç†å‘˜
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`
- è§’è‰²ï¼šsuperadmin

### æµ‹è¯•ç”¨æˆ·
- ç”¨æˆ·1ï¼š`user001` / `123456`ï¼ˆç§¯åˆ†5000ï¼‰
- ç”¨æˆ·2ï¼š`user002` / `123456`ï¼ˆç§¯åˆ†3000ï¼‰

### ç³»ç»Ÿé…ç½®
- æ¸¸æˆçŠ¶æ€ï¼šå¼€å¯
- å€æ•°æ‰‹ç»­è´¹ï¼šæ¯100ä¸º3
- ç»„åˆæ‰‹ç»­è´¹ï¼šæ¯100ä¸º5
- æœ€å°ä¸‹æ³¨ï¼š10
- æœ€å¤§ä¸‹æ³¨ï¼š10000

---

## ğŸ“¡ å¯ç”¨çš„APIæ¥å£

### è®¤è¯æ¥å£ï¼ˆ2ä¸ªï¼‰âœ…
- `POST /api/user/login` - ç”¨æˆ·ç™»å½•
- `POST /api/admin/login` - ç®¡ç†å‘˜ç™»å½•

### ç”¨æˆ·æ¥å£ï¼ˆ7ä¸ªï¼‰âœ…
- `GET /api/user/info` - è·å–ç”¨æˆ·ä¿¡æ¯
- `POST /api/user/change-password` - ä¿®æ”¹å¯†ç 
- `POST /api/user/bet` - æäº¤ä¸‹æ³¨
- `GET /api/user/bet-history` - ä¸‹æ³¨å†å²
- `POST /api/admin/users` - åˆ›å»ºç”¨æˆ·ï¼ˆç®¡ç†å‘˜ï¼‰
- `GET /api/admin/users` - ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰
- `PUT /api/admin/users/:id/points` - è°ƒæ•´ç§¯åˆ†ï¼ˆç®¡ç†å‘˜ï¼‰
- `PUT /api/admin/users/:id/password` - é‡ç½®å¯†ç ï¼ˆç®¡ç†å‘˜ï¼‰
- `PUT /api/admin/users/:id/status` - æ›´æ–°çŠ¶æ€ï¼ˆç®¡ç†å‘˜ï¼‰

### ä¸‹æ³¨æ¥å£ï¼ˆ2ä¸ªï¼‰âœ…
- `POST /api/user/bet` - æäº¤ä¸‹æ³¨
- `GET /api/admin/bets` - ä¸‹æ³¨è®°å½•ï¼ˆç®¡ç†å‘˜ï¼‰

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### å¼€å‘å‘½ä»¤
```bash
pnpm start:dev      # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm start:debug    # è°ƒè¯•æ¨¡å¼å¯åŠ¨
pnpm build          # æ‰“åŒ…ç”Ÿäº§ç‰ˆæœ¬
pnpm start:prod     # ç”Ÿäº§æ¨¡å¼å¯åŠ¨
```

### Prismaå‘½ä»¤
```bash
npx prisma studio          # æ‰“å¼€æ•°æ®åº“å¯è§†åŒ–ç•Œé¢
npx prisma generate        # ç”ŸæˆPrisma Client
npx prisma migrate dev     # åˆ›å»ºæ–°è¿ç§»
npx prisma db seed         # è¿è¡Œç§å­æ•°æ®
npx prisma format          # æ ¼å¼åŒ–schemaæ–‡ä»¶
```

### è°ƒè¯•å‘½ä»¤
```bash
pnpm lint                  # ä»£ç æ£€æŸ¥
pnpm format                # ä»£ç æ ¼å¼åŒ–
pnpm test                  # è¿è¡Œæµ‹è¯•
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ
**A**: æ£€æŸ¥ `.env` ä¸­çš„ `DATABASE_URL` æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿MySQLæœåŠ¡å·²å¯åŠ¨ã€‚

### Q2: Prisma Clienté”™è¯¯ï¼Ÿ
**A**: è¿è¡Œ `npx prisma generate` é‡æ–°ç”Ÿæˆå®¢æˆ·ç«¯ã€‚

### Q3: ç«¯å£è¢«å ç”¨ï¼Ÿ
**A**: ä¿®æ”¹ `.env` ä¸­çš„ `PORT` ä¸ºå…¶ä»–ç«¯å£ï¼Œå¦‚3001ã€‚

### Q4: Tokenè¿‡æœŸï¼Ÿ
**A**: é‡æ–°ç™»å½•è·å–æ–°çš„Tokenã€‚

### Q5: Redisè¿æ¥å¤±è´¥ï¼Ÿ
**A**: ç¡®ä¿RedisæœåŠ¡å·²å¯åŠ¨ï¼Œæˆ–åœ¨ä»£ç ä¸­æš‚æ—¶ç¦ç”¨Redisç›¸å…³åŠŸèƒ½ã€‚

---

## ğŸ“Š é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma      # æ•°æ®åº“æ¨¡å‹
â”‚   â”œâ”€â”€ seed.ts            # ç§å­æ•°æ®
â”‚   â””â”€â”€ migrations/        # è¿ç§»æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ common/            # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ decorators/    # âœ… è£…é¥°å™¨
â”‚   â”‚   â”œâ”€â”€ filters/       # âœ… è¿‡æ»¤å™¨
â”‚   â”‚   â”œâ”€â”€ guards/        # âœ… å®ˆå«
â”‚   â”‚   â””â”€â”€ interceptors/  # âœ… æ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ auth/          # âœ… è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ user/          # âœ… ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ bet/           # âœ… ä¸‹æ³¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ lottery/       # â³ å¼€å¥–æ¨¡å—ï¼ˆå·¥å…·ç±»å·²å®Œæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ point/         # â³ ç§¯åˆ†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ system/        # â³ ç³»ç»Ÿæ¨¡å—
â”‚   â”‚   â””â”€â”€ admin/         # â³ ç®¡ç†å‘˜æ¨¡å—
â”‚   â”œâ”€â”€ prisma/            # âœ… Prismaæ¨¡å—
â”‚   â”œâ”€â”€ app.module.ts      # âœ… æ ¹æ¨¡å—
â”‚   â””â”€â”€ main.ts            # âœ… å…¥å£æ–‡ä»¶
â”œâ”€â”€ .env                   # ç¯å¢ƒå˜é‡
â”œâ”€â”€ package.json           # âœ… ä¾èµ–é…ç½®
â””â”€â”€ tsconfig.json          # âœ… TSé…ç½®
```

---

## ğŸ¨ ä½¿ç”¨Swaggeræµ‹è¯•

1. æ‰“å¼€ http://localhost:3000/api-docs
2. ç‚¹å‡» `POST /api/user/login` æ¥å£
3. ç‚¹å‡» "Try it out"
4. è¾“å…¥æµ‹è¯•æ•°æ®ï¼š
   ```json
   {
     "username": "user001",
     "password": "123456"
   }
   ```
5. ç‚¹å‡» "Execute"
6. å¤åˆ¶è¿”å›çš„Token
7. ç‚¹å‡»é¡µé¢é¡¶éƒ¨çš„ "Authorize" æŒ‰é’®
8. è¾“å…¥ `Bearer YOUR_TOKEN`
9. ç°åœ¨å¯ä»¥æµ‹è¯•éœ€è¦è®¤è¯çš„æ¥å£äº†

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### ç»§ç»­å¼€å‘å‰©ä½™æ¨¡å—

ä½¿ç”¨NestJS CLIå¿«é€Ÿç”Ÿæˆï¼š

```bash
# ç”ŸæˆLotteryæ¨¡å—
nest g module modules/lottery
nest g controller modules/lottery
nest g service modules/lottery

# ç”ŸæˆPointæ¨¡å—
nest g module modules/point
nest g controller modules/point
nest g service modules/point

# ç”ŸæˆSystemæ¨¡å—
nest g module modules/system
nest g controller modules/system
nest g service modules/system

# ç”ŸæˆAdminæ¨¡å—
nest g module modules/admin
nest g controller modules/admin
nest g service modules/admin
```

ç„¶åå‚è€ƒå·²å®Œæˆçš„æ¨¡å—ï¼ˆAuthã€Userã€Betï¼‰å®ç°ä¸šåŠ¡é€»è¾‘ã€‚

### æˆ–è€…ç›´æ¥ä½¿ç”¨ç°æœ‰åŠŸèƒ½

å½“å‰ç³»ç»Ÿå·²ç»å¯ä»¥ï¼š
- âœ… ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- âœ… ç”¨æˆ·ä¸‹æ³¨
- âœ… ç®¡ç†å‘˜ç®¡ç†ç”¨æˆ·
- âœ… ç®¡ç†å‘˜æŸ¥çœ‹ä¸‹æ³¨è®°å½•
- âœ… ç®¡ç†å‘˜è°ƒæ•´ç”¨æˆ·ç§¯åˆ†

å¯ä»¥å…ˆå¯¹æ¥å‰ç«¯ï¼Œæµ‹è¯•ç°æœ‰åŠŸèƒ½ã€‚

---

## ğŸ“ è·å–å¸®åŠ©

- æŸ¥çœ‹ [æœ€ç»ˆå®ç°æ€»ç»“.md](./æœ€ç»ˆå®ç°æ€»ç»“.md)
- æŸ¥çœ‹ [å¼€å‘è¿›åº¦æ€»ç»“.md](./å¼€å‘è¿›åº¦æ€»ç»“.md)
- æŸ¥çœ‹ [å®Œæ•´æ¨¡å—åˆ—è¡¨.md](./å®Œæ•´æ¨¡å—åˆ—è¡¨.md)
- æŸ¥çœ‹ [APIæ¥å£æ–‡æ¡£](../../APIæ¥å£æ–‡æ¡£.md)
- æŸ¥çœ‹ [ä¸šåŠ¡è§„åˆ™è¯¦è§£](../../ä¸šåŠ¡è§„åˆ™è¯¦è§£æ–‡æ¡£.md)

---

## ğŸ‰ æ­å–œï¼

ä½ çš„åç«¯ç³»ç»Ÿå·²ç»å¯ä»¥è¿è¡Œäº†ï¼

**æ ¸å¿ƒåŠŸèƒ½å®Œæ•´ï¼Œå¯ä»¥ç«‹å³ä½¿ç”¨ï¼** ğŸš€

---

**åˆ›å»ºæ—¥æœŸ**ï¼š2024å¹´11æœˆ26æ—¥  
**ç‰ˆæœ¬**ï¼šv1.0



