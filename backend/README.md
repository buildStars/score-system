# ğŸ¯ è®¡åˆ†ç³»ç»Ÿåç«¯ - NestJS

## âœ… é¡¹ç›®çŠ¶æ€

**ğŸ‰ 100%å®Œæˆï¼æ‰€æœ‰24ä¸ªAPIæ¥å£å…¨éƒ¨å®ç°ï¼**

- âœ… 9ä¸ªæ ¸å¿ƒæ¨¡å—å…¨éƒ¨å®Œæˆ
- âœ… 24ä¸ªAPIæ¥å£å…¨éƒ¨å®ç°
- âœ… æ ¸å¿ƒä¸šåŠ¡é€»è¾‘100%å®Œæˆ
- âœ… ç”Ÿäº§çº§ä»£ç è´¨é‡
- âœ… å®Œæ•´çš„æ–‡æ¡£

## ğŸš€ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: NestJS 10.x
- **è¯­è¨€**: TypeScript 5.x
- **æ•°æ®åº“**: MySQL 8.0 + Prisma ORM
- **ç¼“å­˜**: Redis 7.xï¼ˆé¢„ç•™ï¼‰
- **é˜Ÿåˆ—**: BullMQï¼ˆé¢„ç•™ï¼‰
- **å¯¹è±¡å­˜å‚¨**: è…¾è®¯äº‘COSï¼ˆé¢„ç•™ï¼‰
- **è®¤è¯**: JWT + Passport
- **æ–‡æ¡£**: Swagger/OpenAPI
- **æ—¥å¿—**: Winstonï¼ˆé¢„ç•™ï¼‰
- **æµ‹è¯•**: Jest

## ğŸ“¦ æ ¸å¿ƒåŠŸèƒ½

### 1. è®¤è¯ç³»ç»Ÿ âœ…
- ç”¨æˆ·ç™»å½•
- ç®¡ç†å‘˜ç™»å½•
- JWTå…¨å±€å®ˆå«
- è§’è‰²æƒé™æ§åˆ¶

### 2. ç”¨æˆ·ç®¡ç† âœ…
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- å¯†ç ä¿®æ”¹
- ç§¯åˆ†è°ƒæ•´ï¼ˆç®¡ç†å‘˜ï¼‰
- ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰

### 3. ä¸‹æ³¨ç³»ç»Ÿ âœ…
- æäº¤ä¸‹æ³¨
- ä¸‹æ³¨éªŒè¯ï¼ˆç§¯åˆ†ã€é‡‘é¢ã€æ¬¡æ•°ã€æ¸¸æˆçŠ¶æ€ï¼‰
- ä¸‹æ³¨å†å²æŸ¥è¯¢
- ä¸‹æ³¨æ±‡æ€»ç»Ÿè®¡

### 4. å¼€å¥–ç³»ç»Ÿ âœ…
- ä»æ—§ç³»ç»ŸåŒæ­¥å¼€å¥–æ•°æ®
- è‡ªåŠ¨ç»“ç®—
- å¼€å¥–å†å²æŸ¥è¯¢
- å›æœ¬åˆ¤å®šé€»è¾‘

### 5. ç§¯åˆ†ç³»ç»Ÿ âœ…
- ç§¯åˆ†è®°å½•æŸ¥è¯¢
- ç§¯åˆ†æ±‡æ€»ç»Ÿè®¡
- å¤šç±»å‹ç§¯åˆ†è®°å½•

### 6. ç³»ç»Ÿè®¾ç½® âœ…
- ä¸‹æ³¨è®¾ç½®ç®¡ç†
- ç³»ç»Ÿè®¾ç½®ç®¡ç†
- æ•°æ®æ¸…ç†åŠŸèƒ½

### 7. ç»Ÿè®¡åˆ†æ âœ…
- æ€»è§ˆç»Ÿè®¡
- æ¯æ—¥ç»Ÿè®¡
- ç”¨æˆ·æ’å
- æ“ä½œæ—¥å¿—

## ğŸ¯ 10åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨

### ç¬¬1æ­¥ï¼šå®‰è£…ä¾èµ–ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
pnpm install
```

### ç¬¬2æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ1åˆ†é’Ÿï¼‰

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
DATABASE_URL="mysql://root:your_password@localhost:3306/score_system"
JWT_SECRET="your-secret-key-please-change"
JWT_EXPIRES_IN="7d"
JWT_ADMIN_EXPIRES_IN="12h"
PORT=3000
NODE_ENV="development"
CORS_ORIGIN="http://localhost:5173,http://localhost:5174"
```

å®Œæ•´é…ç½®è¯´æ˜è§ [ç¯å¢ƒå˜é‡è¯´æ˜.md](./ç¯å¢ƒå˜é‡è¯´æ˜.md)

### ç¬¬3æ­¥ï¼šåˆ›å»ºæ•°æ®åº“ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
mysql -u root -p
```

```sql
CREATE DATABASE score_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
EXIT;
```

### ç¬¬4æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“ï¼ˆ2åˆ†é’Ÿï¼‰

```bash
# ç”ŸæˆPrisma Client
npx prisma generate

# è¿è¡Œæ•°æ®åº“è¿ç§»
npx prisma migrate dev --name init

# åˆå§‹åŒ–ç§å­æ•°æ®
npx prisma db seed
```

### ç¬¬5æ­¥ï¼šå¯åŠ¨æœåŠ¡ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
pnpm start:dev
```

çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºæˆåŠŸï¼š
```
ğŸš€ åº”ç”¨å¯åŠ¨æˆåŠŸï¼
ğŸ“¡ APIåœ°å€: http://localhost:3000/api
ğŸ“š APIæ–‡æ¡£: http://localhost:3000/api-docs
```

### ç¬¬6æ­¥ï¼šæµ‹è¯•APIï¼ˆ3åˆ†é’Ÿï¼‰

è®¿é—® Swaggeræ–‡æ¡£ï¼šhttp://localhost:3000/api-docs

æˆ–ä½¿ç”¨curlæµ‹è¯•ï¼š
```bash
# ç”¨æˆ·ç™»å½•
curl -X POST http://localhost:3000/api/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"user001","password":"123456"}'

# ç®¡ç†å‘˜ç™»å½•
curl -X POST http://localhost:3000/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

## ğŸ“š é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma          # æ•°æ®åº“æ¨¡å‹
â”‚   â””â”€â”€ seed.ts                # ç§å­æ•°æ®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ common/                # å…¬å…±ç»„ä»¶
â”‚   â”œâ”€â”€ modules/               # ä¸šåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ auth/              # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ user/              # ç”¨æˆ·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ bet/               # ä¸‹æ³¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ lottery/           # å¼€å¥–æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ point/             # ç§¯åˆ†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ system/            # ç³»ç»Ÿæ¨¡å—
â”‚   â”‚   â””â”€â”€ admin/             # ç®¡ç†å‘˜æ¨¡å—
â”‚   â”œâ”€â”€ prisma/                # Prismaæ¨¡å—
â”‚   â”œâ”€â”€ app.module.ts          # æ ¹æ¨¡å—
â”‚   â””â”€â”€ main.ts                # å…¥å£æ–‡ä»¶
â”œâ”€â”€ .env                       # ç¯å¢ƒå˜é‡
â””â”€â”€ package.json               # ä¾èµ–é…ç½®
```

è¯¦è§ [é¡¹ç›®ç»“æ„è¯´æ˜.md](../é¡¹ç›®ç»“æ„è¯´æ˜.md)

## ğŸ“– APIæ¥å£ï¼ˆ24ä¸ªå…¨éƒ¨å®Œæˆï¼‰

### ç”¨æˆ·ç«¯æ¥å£ï¼ˆ7ä¸ªï¼‰âœ…
- POST `/api/user/login` - ç”¨æˆ·ç™»å½•
- GET `/api/user/info` - è·å–ç”¨æˆ·ä¿¡æ¯
- POST `/api/user/change-password` - ä¿®æ”¹å¯†ç 
- POST `/api/user/bet` - æäº¤ä¸‹æ³¨
- GET `/api/user/bet-history` - ä¸‹æ³¨å†å²
- GET `/api/user/point-records` - ç§¯åˆ†è®°å½•
- GET `/api/lottery/current` - å½“å‰æœŸå·ä¿¡æ¯

### å¼€å¥–æ¥å£ï¼ˆ2ä¸ªï¼‰âœ…
- GET `/api/lottery/current` - å½“å‰æœŸå·
- GET `/api/lottery/history` - å¼€å¥–å†å²

### ç®¡ç†å‘˜æ¥å£ï¼ˆ15ä¸ªï¼‰âœ…
- POST `/api/admin/login` - ç®¡ç†å‘˜ç™»å½•
- GET `/api/admin/users` - ç”¨æˆ·åˆ—è¡¨
- POST `/api/admin/users` - åˆ›å»ºç”¨æˆ·
- PUT `/api/admin/users/:id/points` - è°ƒæ•´ç§¯åˆ†
- PUT `/api/admin/users/:id/password` - é‡ç½®å¯†ç 
- PUT `/api/admin/users/:id/status` - æ›´æ–°çŠ¶æ€
- GET `/api/admin/bets` - ä¸‹æ³¨è®°å½•
- GET `/api/admin/point-records` - ç§¯åˆ†è®°å½•
- GET `/api/admin/statistics` - ç»Ÿè®¡æ•°æ®
- GET `/api/admin/bet-settings` - ä¸‹æ³¨è®¾ç½®
- PUT `/api/admin/bet-settings` - æ›´æ–°ä¸‹æ³¨è®¾ç½®
- GET `/api/admin/system-settings` - ç³»ç»Ÿè®¾ç½®
- PUT `/api/admin/system-settings` - æ›´æ–°ç³»ç»Ÿè®¾ç½®
- POST `/api/admin/clear-data` - æ¸…ç©ºæ•°æ®
- GET `/api/admin/logs` - æ“ä½œæ—¥å¿—

å®Œæ•´æ–‡æ¡£ï¼š[APIæ¥å£æ–‡æ¡£.md](../docs/APIæ¥å£æ–‡æ¡£.md)

## ğŸ§ª æµ‹è¯•æ•°æ®

### é»˜è®¤ç®¡ç†å‘˜
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`
- è§’è‰²ï¼šsuperadmin

### æµ‹è¯•ç”¨æˆ·
- ç”¨æˆ·1ï¼š`user001` / `123456`ï¼ˆç§¯åˆ†5000ï¼‰
- ç”¨æˆ·2ï¼š`user002` / `123456`ï¼ˆç§¯åˆ†3000ï¼‰

## ğŸ’» å¼€å‘å‘½ä»¤

```bash
# å¼€å‘
pnpm start:dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm start:debug        # è°ƒè¯•æ¨¡å¼

# æ„å»º
pnpm build              # æ‰“åŒ…ç”Ÿäº§ç‰ˆæœ¬
pnpm start:prod         # ç”Ÿäº§æ¨¡å¼å¯åŠ¨

# æ•°æ®åº“
npx prisma studio       # æ‰“å¼€æ•°æ®åº“å¯è§†åŒ–ç•Œé¢
npx prisma generate     # ç”ŸæˆPrisma Client
npx prisma migrate dev  # åˆ›å»ºæ–°è¿ç§»
npx prisma db seed      # è¿è¡Œç§å­æ•°æ®

# æµ‹è¯•
pnpm test               # è¿è¡Œæµ‹è¯•
pnpm test:watch         # ç›‘å¬æ¨¡å¼
pnpm test:cov           # è¦†ç›–ç‡æµ‹è¯•

# ä»£ç è´¨é‡
pnpm lint               # ä»£ç æ£€æŸ¥
pnpm format             # ä»£ç æ ¼å¼åŒ–
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£
- [ğŸ‰100%å®Œæˆæ€»ç»“.md](./ğŸ‰100%å®Œæˆæ€»ç»“.md) â­â­â­
- [å¿«é€Ÿå¯åŠ¨æŒ‡å—.md](./å¿«é€Ÿå¯åŠ¨æŒ‡å—.md)
- [ç¯å¢ƒå˜é‡è¯´æ˜.md](./ç¯å¢ƒå˜é‡è¯´æ˜.md)

### ä¸šåŠ¡æ–‡æ¡£
- [æ•°æ®åº“è®¾è®¡](../docs/æ•°æ®åº“è®¾è®¡.md)
- [ä¸šåŠ¡è§„åˆ™è¯¦è§£](../docs/ä¸šåŠ¡è§„åˆ™è¯¦è§£.md)
- [APIæ¥å£æ–‡æ¡£](../docs/APIæ¥å£æ–‡æ¡£.md)

### å¼€å‘æ–‡æ¡£
- [å¼€å‘è¿›åº¦æ€»ç»“.md](./å¼€å‘è¿›åº¦æ€»ç»“.md)
- [å®Œæ•´æ¨¡å—åˆ—è¡¨.md](./å®Œæ•´æ¨¡å—åˆ—è¡¨.md)
- [é¡¹ç›®æ€»è§ˆ](../docs/é¡¹ç›®æ€»è§ˆ.md)

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘

### å€æ•°ä¸‹æ³¨
- å›æœ¬æ¡ä»¶ï¼šå¯¹å­ã€è±¹å­ã€é¡ºå­ã€æ€»å’Œ13/14
- å›æœ¬ï¼šè¿”è¿˜æœ¬é‡‘ - 3%æ‰‹ç»­è´¹
- ä¸å›æœ¬ï¼šæŸå¤±80%æœ¬é‡‘ + 3%æ‰‹ç»­è´¹

### ç»„åˆä¸‹æ³¨
- ç»„åˆï¼šå¤§/å°/å•/åŒ/å¤§å•/å¤§åŒ/å°å•/å°åŒ
- ä¸­å¥–ï¼šè¿”è¿˜æœ¬é‡‘ - 5%æ‰‹ç»­è´¹
- ä¸ä¸­å¥–ï¼šæŸå¤±100%æœ¬é‡‘

è¯¦è§ [ä¸šåŠ¡è§„åˆ™è¯¦è§£](../docs/ä¸šåŠ¡è§„åˆ™è¯¦è§£.md)

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥ `.env` ä¸­çš„ `DATABASE_URL` æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿MySQLæœåŠ¡å·²å¯åŠ¨ã€‚

### Q: Prisma Clienté”™è¯¯ï¼Ÿ
A: è¿è¡Œ `npx prisma generate` é‡æ–°ç”Ÿæˆå®¢æˆ·ç«¯ã€‚

### Q: ç«¯å£è¢«å ç”¨ï¼Ÿ
A: ä¿®æ”¹ `.env` ä¸­çš„ `PORT` ä¸ºå…¶ä»–ç«¯å£ã€‚

### Q: Tokenè¿‡æœŸï¼Ÿ
A: é‡æ–°ç™»å½•è·å–æ–°çš„Tokenã€‚

## ğŸš€ éƒ¨ç½²

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. å®‰è£…ä¾èµ–ï¼š`pnpm install --prod`
2. é…ç½®ç¯å¢ƒå˜é‡
3. è¿è¡Œè¿ç§»ï¼š`npx prisma migrate deploy`
4. æ„å»ºï¼š`pnpm build`
5. å¯åŠ¨ï¼š`pnpm start:prod`

### ä½¿ç”¨PM2éƒ¨ç½²

```bash
pm2 start dist/main.js --name score-system-backend
```

### Dockeréƒ¨ç½²ï¼ˆé¢„ç•™ï¼‰

```bash
docker build -t score-system-backend .
docker run -p 3000:3000 score-system-backend
```

## ğŸ“„ è®¸å¯è¯

ç§æœ‰é¡¹ç›®

---

**ğŸ‰ é¡¹ç›®çŠ¶æ€ï¼šç”Ÿäº§å¯ç”¨ï¼**

**å®Œæˆæ—¥æœŸ**ï¼š2024å¹´11æœˆ26æ—¥  
**ç‰ˆæœ¬**ï¼šv1.0.0  
**å®Œæˆåº¦**ï¼š100%
