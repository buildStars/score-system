# 🚀 计分系统 - 完整启动指南

## 📋 系统组成

本项目包含三个部分：
1. **Backend** - 后端 API 服务（Node.js + Express + Prisma）
2. **Frontend-Admin** - 管理后台（Vue 3 + TypeScript + Element Plus）✅ 已完成
3. **Frontend-H5** - H5 用户端（Vue 3 + TypeScript + Vant）

---

## ⚙️ 环境要求

- **Node.js** >= 18.0.0
- **MySQL** >= 8.0
- **npm** >= 9.0.0

---

## 🎯 快速启动（三步走）

### 第一步：启动后端服务

```bash
# 进入后端目录
cd score-system/backend

# 安装依赖（如果还没安装）
npm install

# 配置数据库
# 复制 .env.example 为 .env，并修改数据库配置
cp .env.example .env

# 初始化数据库
npx prisma migrate dev

# 启动后端服务
npm run dev
```

**后端服务地址：** http://localhost:3000

---

### 第二步：启动管理后台 ✅

管理后台已经启动并运行！

```bash
# 如果需要重新启动
cd score-system/frontend-admin
npm run dev
```

**管理后台地址：** http://localhost:5174

**默认管理员账号：**
- 账号：`admin`
- 密码：`admin123`

---

### 第三步：启动 H5 用户端（可选）

```bash
# 进入 H5 目录
cd score-system/frontend-h5

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

**H5 用户端地址：** http://localhost:5173

---

## 📊 服务状态检查

### 检查后端服务

```bash
# 访问健康检查接口
curl http://localhost:3000/health
```

### 检查管理后台

打开浏览器访问：http://localhost:5174

### 检查 H5 端

打开浏览器访问：http://localhost:5173

---

## 🎯 快速测试流程

### 1. 测试管理后台

1. **登录管理后台**
   - 访问：http://localhost:5174
   - 账号：`admin`
   - 密码：`admin123`

2. **创建测试用户**
   - 进入"用户管理"页面
   - 点击"创建用户"
   - 填写用户信息并设置初始积分

3. **配置系统**
   - 进入"模式设置"配置下注规则
   - 进入"网站设置"配置系统参数

4. **查看统计数据**
   - 返回首页查看统计图表
   - 查看用户排行榜

### 2. 测试 H5 用户端

1. **用户登录**
   - 访问：http://localhost:5173
   - 使用刚创建的用户账号登录

2. **查看开奖信息**
   - 查看当前期号
   - 查看历史开奖记录

3. **进行下注**
   - 选择下注类型（倍数/组合）
   - 输入下注金额
   - 提交下注

4. **查看记录**
   - 查看下注历史
   - 查看积分变动记录

---

## 🔧 配置说明

### 后端配置（.env）

```env
# 数据库配置
DATABASE_URL="mysql://用户名:密码@localhost:3306/数据库名"

# 服务器配置
PORT=3000

# JWT 密钥
JWT_SECRET=your-secret-key

# 开奖数据源
LOTTERY_API_URL=http://localhost:8081/userApi/Lott
```

### 管理后台配置

配置文件：`frontend-admin/vite.config.ts`

```typescript
server: {
  port: 5174,
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true,
    },
  },
}
```

### H5 端配置

配置文件：`frontend-h5/vite.config.ts`

```typescript
server: {
  port: 5173,
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true,
    },
  },
}
```

---

## 📝 端口说明

| 服务 | 端口 | 地址 |
|------|------|------|
| 后端 API | 3000 | http://localhost:3000 |
| 管理后台 | 5174 | http://localhost:5174 |
| H5 用户端 | 5173 | http://localhost:5173 |
| MySQL | 3306 | localhost:3306 |

---

## 🐛 常见问题

### 1. 端口被占用

**问题：** EADDRINUSE: address already in use

**解决方案：**
```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID <进程ID> /F

# Linux/Mac
lsof -ti:3000 | xargs kill -9
```

### 2. 数据库连接失败

**问题：** Can't connect to MySQL server

**解决方案：**
1. 检查 MySQL 服务是否启动
2. 检查 .env 中的数据库配置
3. 确认数据库用户权限
4. 检查防火墙设置

### 3. 后端启动失败

**问题：** Module not found

**解决方案：**
```bash
# 删除 node_modules 和 package-lock.json
rm -rf node_modules package-lock.json

# 清除 npm 缓存
npm cache clean --force

# 重新安装
npm install
```

### 4. 前端页面空白

**问题：** 页面无法加载

**解决方案：**
1. 检查浏览器控制台错误
2. 确认后端服务已启动
3. 检查 API 代理配置
4. 清除浏览器缓存

### 5. API 请求失败

**问题：** Network Error 或 404

**解决方案：**
1. 确认后端服务运行正常
2. 检查 vite.config.ts 中的 proxy 配置
3. 查看浏览器 Network 面板
4. 确认 API 地址正确

---

## 📊 数据库初始化

### 创建数据库

```sql
CREATE DATABASE score_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 运行迁移

```bash
cd score-system/backend
npx prisma migrate dev --name init
```

### 生成测试数据（可选）

```bash
npx prisma db seed
```

---

## 🎯 开发流程

### 1. 修改后端代码

```bash
# 后端使用 nodemon，修改后自动重启
cd score-system/backend
npm run dev
```

### 2. 修改前端代码

```bash
# Vite 提供热更新，修改后自动刷新
cd score-system/frontend-admin
npm run dev
```

### 3. 查看日志

```bash
# 后端日志
tail -f score-system/backend/logs/app.log

# 浏览器控制台
F12 -> Console
```

---

## 🔄 完整重启流程

### 停止所有服务

```bash
# Windows
Ctrl + C (在每个终端窗口)

# 或者强制结束
taskkill /F /IM node.exe
```

### 启动所有服务

**终端 1 - 后端：**
```bash
cd score-system/backend
npm run dev
```

**终端 2 - 管理后台：**
```bash
cd score-system/frontend-admin
npm run dev
```

**终端 3 - H5 用户端：**
```bash
cd score-system/frontend-h5
npm run dev
```

---

## 📱 访问地址总览

### 开发环境

- 🔧 **后端 API：** http://localhost:3000
- 💻 **管理后台：** http://localhost:5174
- 📱 **H5 用户端：** http://localhost:5173
- 📚 **API 文档：** http://localhost:3000/api-docs

### 默认账号

**管理员账号：**
- 账号：`admin`
- 密码：`admin123`

**测试用户：** 需要在管理后台创建

---

## 🎨 推荐开发工具

### 编辑器
- **VS Code** + Vue 扩展
- **WebStorm**

### 浏览器扩展
- **Vue DevTools**
- **React DevTools**（如果用到 React）

### API 测试工具
- **Postman**
- **Insomnia**
- **Thunder Client**（VS Code 扩展）

### 数据库管理
- **MySQL Workbench**
- **Navicat**
- **DBeaver**

---

## 📝 注意事项

### ⚠️ 重要提醒

1. **首次启动前必须配置数据库**
2. **确保所有端口未被占用**
3. **Node.js 版本必须 >= 18**
4. **建议使用 PowerShell 或 Git Bash**
5. **开发时建议开启 3 个终端窗口**

### 💡 开发建议

1. **代码修改后及时测试**
2. **遵循项目代码规范**
3. **提交前检查 ESLint**
4. **重要修改前备份数据库**
5. **定期 git commit**

---

## 🎉 启动成功标志

当你看到以下信息时，说明启动成功：

### 后端
```
✓ Server running on http://localhost:3000
✓ Database connected successfully
✓ Prisma Client initialized
```

### 管理后台
```
  VITE v6.0.7  ready in 1234 ms

  ➜  Local:   http://localhost:5174/
  ➜  Network: use --host to expose
```

### H5 用户端
```
  VITE v6.0.7  ready in 1234 ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

---

## 🎯 快速验证

### 1. 后端验证
```bash
curl http://localhost:3000/health
# 应该返回：{"status":"ok"}
```

### 2. 管理后台验证
访问 http://localhost:5174，应该看到登录页面

### 3. H5 端验证
访问 http://localhost:5173，应该看到首页

---

## 📞 需要帮助？

遇到问题？查看以下文档：

- 📘 **后端文档：** `backend/README.md`
- 📗 **管理后台文档：** `frontend-admin/使用指南.md`
- 📙 **H5 端文档：** `frontend-h5/README.md`
- 📕 **API 文档：** `API接口文档.md`

---

**祝你开发愉快！🎉**





