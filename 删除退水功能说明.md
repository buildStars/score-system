# åˆ é™¤é€€æ°´åŠŸèƒ½è¯´æ˜ ğŸ—‘ï¸

## ä¿®æ”¹æ¦‚è¿°

æ ¹æ®ç”¨æˆ·éœ€æ±‚ï¼Œå·²å°†"é€€æ°´ï¼ˆrebateRateï¼‰"æ¦‚å¿µä»ç³»ç»Ÿä¸­å®Œå…¨åˆ é™¤ã€‚

## ä¿®æ”¹è¯¦æƒ…

### 1. åç«¯ä¿®æ”¹

#### 1.1 æ•°æ®åº“ Schema (prisma/schema.prisma)
- âœ… ä» `BetTypeSetting` æ¨¡å‹ä¸­åˆ é™¤äº† `rebateRate` å­—æ®µ
- âœ… åˆ›å»ºäº†æ•°æ®åº“è¿ç§»æ–‡ä»¶ `remove_rebate_rate.sql`

```sql
ALTER TABLE `bet_type_settings` DROP COLUMN IF EXISTS `rebate_rate`;
```

#### 1.2 DTO å®šä¹‰ (dto/bet-type-setting.dto.ts)
- âœ… ä» `BetTypeSettingDto` ä¸­åˆ é™¤ `rebateRate` å­—æ®µåŠå…¶éªŒè¯è£…é¥°å™¨
- âœ… ä» `UpdateBetTypeSettingDto` ä¸­åˆ é™¤ `rebateRate` å­—æ®µåŠå…¶éªŒè¯è£…é¥°å™¨
- âœ… æ–°å¢ `BetTypeSettingItemDto` ç±»ç”¨äºæ‰¹é‡æ›´æ–°
- âœ… ä¿®å¤äº† `Type` è£…é¥°å™¨çš„å¯¼å…¥ï¼ˆä» `class-transformer` è€Œä¸æ˜¯ `class-validator`ï¼‰
- âœ… ä¿®å¤äº† `BatchUpdateBetTypeSettingsDto` çš„éªŒè¯

```typescript
import { Type } from 'class-transformer'; // æ­£ç¡®çš„å¯¼å…¥

export class BetTypeSettingItemDto extends UpdateBetTypeSettingDto {
  @ApiProperty({ description: 'ä¸‹æ³¨ç±»å‹' })
  @IsString()
  betType: string;
}

export class BatchUpdateBetTypeSettingsDto {
  @ApiProperty({ description: 'ä¸‹æ³¨ç±»å‹è®¾ç½®åˆ—è¡¨', type: [BetTypeSettingItemDto] })
  @ValidateNested({ each: true })
  @Type(() => BetTypeSettingItemDto)
  settings: BetTypeSettingItemDto[];
}
```

#### 1.3 Service å±‚ (system.service.ts)
- âœ… åˆ é™¤äº† `rebateRate` çš„éªŒè¯é€»è¾‘
- âœ… ä¿ç•™æ‰¹é‡æ›´æ–°åŠŸèƒ½ï¼Œç°åœ¨ä¸å†å¤„ç† `rebateRate`

### 2. å‰ç«¯ä¿®æ”¹

#### 2.1 ç±»å‹å®šä¹‰ (types/index.ts)
- âœ… ä» `BetTypeSetting` æ¥å£ä¸­åˆ é™¤ `rebateRate` å­—æ®µ

```typescript
export interface BetTypeSetting {
  id: number
  betType: string
  name: string
  odds: number
  minBet: number
  maxBet: number
  feeRate: number
  // rebateRate å·²åˆ é™¤
  isEnabled: boolean
  sortOrder: number
  description?: string
}
```

#### 2.2 é¡µé¢ç»„ä»¶ (BetTypeSettings.vue)
- âœ… åˆ é™¤äº†"é€€æ°´(%)"åˆ—
- âœ… è°ƒæ•´äº†"æ‰‹ç»­è´¹(%)"åˆ—å®½ä¸º 150px
- âœ… ä»æ•°æ®è·å–å’Œä¿å­˜é€»è¾‘ä¸­åˆ é™¤ `rebateRate` å¤„ç†
- âœ… ä»é…ç½®è¯´æ˜ä¸­åˆ é™¤é€€æ°´ç›¸å…³è¯´æ˜
- âœ… ç¡®ä¿æ‰€æœ‰æ•°å­—å­—æ®µç±»å‹æ­£ç¡®ï¼ˆä¿®å¤äº† ElInputNumber çš„ç±»å‹è­¦å‘Šï¼‰

### 3. æ•°æ®åº“è¿ç§»

**è¿ç§»æ–‡ä»¶**: `score-system/backend/prisma/migrations/remove_rebate_rate.sql`

æ‰§è¡Œè¿ç§»å‘½ä»¤ï¼š
```bash
cd score-system/backend

# æ–¹å¼1: ä½¿ç”¨ MySQL å®¢æˆ·ç«¯
mysql -u root -p score_system < prisma/migrations/remove_rebate_rate.sql

# æ–¹å¼2: ä½¿ç”¨ Prisma
npx prisma migrate dev --name remove_rebate_rate
```

## åŠŸèƒ½å½±å“

### ä¿ç•™çš„åŠŸèƒ½
- âœ… èµ”ç‡è®¾ç½®
- âœ… æœ€å°/æœ€å¤§æŠ•æ³¨é¢è®¾ç½®
- âœ… æ‰‹ç»­è´¹è®¾ç½®ï¼ˆç™¾åˆ†æ¯”ï¼‰
- âœ… å¯ç”¨/ç¦ç”¨å¼€å…³
- âœ… æ’åº
- âœ… è¯´æ˜æ–‡å­—
- âœ… æ‰¹é‡ä¿å­˜
- âœ… å•é¡¹é‡ç½®

### åˆ é™¤çš„åŠŸèƒ½
- âŒ é€€æ°´æ¯”ä¾‹è®¾ç½®
- âŒ é€€æ°´ç›¸å…³çš„éªŒè¯é€»è¾‘
- âŒ é€€æ°´ç›¸å…³çš„ UI å±•ç¤º

## æµ‹è¯•å»ºè®®

1. **æ‰¹é‡æ›´æ–°æµ‹è¯•**
   - æµ‹è¯•ä¿®æ”¹å¤šä¸ªä¸‹æ³¨ç±»å‹çš„é…ç½®
   - éªŒè¯è¯·æ±‚å‚æ•°æ ¼å¼æ­£ç¡®ï¼ˆæ•°ç»„å½¢å¼ï¼Œå¸¦ `settings` å­—æ®µï¼‰
   
2. **å•é¡¹æ›´æ–°æµ‹è¯•**
   - æµ‹è¯•ä¿®æ”¹å•ä¸ªä¸‹æ³¨ç±»å‹çš„é…ç½®
   - éªŒè¯ä¸åŒ…å« `rebateRate` å­—æ®µ

3. **æ•°æ®éªŒè¯æµ‹è¯•**
   - éªŒè¯æ‰‹ç»­è´¹å¿…é¡»åœ¨ 0-100% ä¹‹é—´
   - éªŒè¯æœ€å°æŠ•æ³¨é¢ä¸èƒ½å¤§äºæœ€å¤§æŠ•æ³¨é¢
   - éªŒè¯å¿…å¡«å­—æ®µ

4. **å‰ç«¯æ˜¾ç¤ºæµ‹è¯•**
   - éªŒè¯è¡¨æ ¼ä¸å†æ˜¾ç¤º"é€€æ°´"åˆ—
   - éªŒè¯è¡¨æ ¼å®½åº¦è‡ªé€‚åº”æ­£å¸¸
   - éªŒè¯æ•°å­—è¾“å…¥æ¡†æ— ç±»å‹è­¦å‘Š

## æ•°æ®ç¤ºä¾‹

ä¿å­˜æ—¶çš„æ­£ç¡®è¯·æ±‚æ ¼å¼ï¼š

```json
{
  "settings": [
    {
      "betType": "single",
      "name": "å•",
      "odds": 1.95,
      "minBet": 1,
      "maxBet": 4999,
      "feeRate": 0.03,
      "isEnabled": true,
      "sortOrder": 1,
      "description": "ç»“æœä¸ºå•æ•°"
    }
  ]
}
```

æ³¨æ„ï¼š
- âœ… `feeRate` ç°åœ¨ä»å‰ç«¯çš„ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰è½¬æ¢ä¸ºåç«¯çš„å°æ•°ï¼ˆ0-1ï¼‰
- âœ… ä¸å†åŒ…å« `rebateRate` å­—æ®µ
- âœ… è¯·æ±‚ä½“åŒ…å« `settings` æ•°ç»„

## å®ŒæˆçŠ¶æ€

- âœ… åç«¯ DTO ä¿®å¤
- âœ… åç«¯ Service ä¿®å¤
- âœ… åç«¯ Schema æ›´æ–°
- âœ… å‰ç«¯ç±»å‹å®šä¹‰æ›´æ–°
- âœ… å‰ç«¯é¡µé¢ UI æ›´æ–°
- âœ… å‰ç«¯æ•°æ®å¤„ç†é€»è¾‘æ›´æ–°
- âœ… æ•°æ®åº“è¿ç§»æ–‡ä»¶åˆ›å»º
- âœ… ä»£ç  Linter æ£€æŸ¥é€šè¿‡
- âœ… ç±»å‹å¯¼å…¥é”™è¯¯ä¿®å¤ï¼ˆType ä» class-transformerï¼‰

## ä¸‹ä¸€æ­¥æ“ä½œ

1. **é‡å¯åç«¯æœåŠ¡**
   ```bash
   cd score-system/backend
   npm run start:dev
   ```

2. **æ‰§è¡Œæ•°æ®åº“è¿ç§»**ï¼ˆå¦‚æœæ•°æ®åº“å·²æœ‰ rebate_rate åˆ—ï¼‰
   ```bash
   mysql -u root -p score_system < prisma/migrations/remove_rebate_rate.sql
   ```

3. **æµ‹è¯•åŠŸèƒ½**
   - è®¿é—®å‰ç«¯ç®¡ç†é¡µé¢çš„"æ¨¡å¼è®¾ç½®"
   - å°è¯•æ‰¹é‡ä¿å­˜é…ç½®
   - éªŒè¯ä¿å­˜æˆåŠŸä¸”æ— é”™è¯¯

## é—®é¢˜æ’æŸ¥

å¦‚æœé‡åˆ° `property settings should not exist` é”™è¯¯ï¼š
- âœ… å·²ä¿®å¤ï¼šå¢åŠ äº† `@ValidateNested` å’Œ `@Type` è£…é¥°å™¨
- âœ… å·²ä¿®å¤ï¼šåˆ›å»ºäº†ç‹¬ç«‹çš„ `BetTypeSettingItemDto` ç±»

å¦‚æœé‡åˆ° `Type is not a function` é”™è¯¯ï¼š
- âœ… å·²ä¿®å¤ï¼šä» `class-transformer` è€Œä¸æ˜¯ `class-validator` å¯¼å…¥ `Type`



