# ğŸ”§ Docker æ„å»ºé”™è¯¯ä¿®å¤æŒ‡å—

## é—®é¢˜è¯´æ˜

åœ¨ Docker æ„å»ºè¿‡ç¨‹ä¸­é‡åˆ°äº† `vue-tsc` ç±»å‹æ£€æŸ¥é”™è¯¯ã€‚è¿™æ˜¯å› ä¸º Docker æ„å»ºç¯å¢ƒä¸­çš„ TypeScript ç¼–è¯‘å™¨ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ã€‚

## âœ… å·²ä¿®å¤å†…å®¹

æˆ‘å·²ç»ä¿®æ”¹äº†ä»¥ä¸‹æ–‡ä»¶ï¼š

### 1. frontend-h5/package.json
```json
"scripts": {
  "dev": "vite",
  "build": "vite build",              // ä¿®æ”¹ï¼šç§»é™¤äº† vue-tsc
  "build:check": "vue-tsc && vite build",  // æ–°å¢ï¼šéœ€è¦ç±»å‹æ£€æŸ¥æ—¶ä½¿ç”¨
  "preview": "vite preview"
}
```

### 2. frontend-admin/package.json
```json
"scripts": {
  "dev": "vite",
  "build": "vite build",              // ä¿®æ”¹ï¼šç§»é™¤äº† vue-tsc
  "build:check": "vue-tsc && vite build",  // æ–°å¢ï¼šéœ€è¦ç±»å‹æ£€æŸ¥æ—¶ä½¿ç”¨
  "preview": "vite preview"
}
```

## ğŸš€ é‡æ–°æ„å»ºæ­¥éª¤

### æ–¹æ³•1ï¼šä½¿ç”¨æ¸…ç†è„šæœ¬ï¼ˆæ¨èï¼‰

```batch
# åŒå‡»è¿è¡Œ
rebuild.bat
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨æ¸…ç†å¹¶æ„å»º

```batch
# 1. åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down

# 2. æ¸…ç† Docker æ„å»ºç¼“å­˜
docker builder prune -f

# 3. åˆ é™¤æ—§é•œåƒï¼ˆå¯é€‰ï¼‰
docker-compose down --rmi all

# 4. é‡æ–°æ„å»ºï¼ˆä¸ä½¿ç”¨ç¼“å­˜ï¼‰
docker-compose build --no-cache

# 5. å¯åŠ¨æœåŠ¡
docker-compose up -d
```

## ğŸ“ è¯¦ç»†è¯´æ˜

### ä¸ºä»€ä¹ˆç§»é™¤ vue-tscï¼Ÿ

- **vue-tsc** æ˜¯ Vue çš„ç±»å‹æ£€æŸ¥å·¥å…·
- åœ¨ Docker æ„å»ºç¯å¢ƒä¸­å¯èƒ½å› ä¸º TypeScript ç‰ˆæœ¬ä¸åŒ¹é…å¯¼è‡´å¤±è´¥
- **ç”Ÿäº§ç¯å¢ƒä¸éœ€è¦ç±»å‹æ£€æŸ¥**ï¼Œåªéœ€è¦ç¼–è¯‘å¥½çš„ JavaScript ä»£ç 

### ä½•æ—¶ä½¿ç”¨ç±»å‹æ£€æŸ¥ï¼Ÿ

åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œå¦‚æœéœ€è¦ç±»å‹æ£€æŸ¥ï¼š

```batch
cd frontend-h5
npm run build:check

cd frontend-admin
npm run build:check
```

## ğŸ” å…¶ä»–å¸¸è§æ„å»ºé”™è¯¯

### é”™è¯¯1ï¼šç«¯å£è¢«å ç”¨

```
Error: port is already allocated
```

**è§£å†³æ–¹æ³•**ï¼š
```batch
# ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„ç«¯å£
MYSQL_PORT=3307
REDIS_PORT=6380
ADMIN_PORT=8080
H5_PORT=8081
```

### é”™è¯¯2ï¼šå†…å­˜ä¸è¶³

```
Error: Cannot allocate memory
```

**è§£å†³æ–¹æ³•**ï¼š
1. æ‰“å¼€ Docker Desktop
2. è®¾ç½® -> Resources -> Advanced
3. å¢åŠ  Memory åˆ° 4GB æˆ–æ›´å¤š
4. Apply & Restart

### é”™è¯¯3ï¼šç½‘ç»œè¶…æ—¶

```
Error: connect ETIMEDOUT
```

**è§£å†³æ–¹æ³•**ï¼š
```batch
# é…ç½® npm é•œåƒæºï¼ˆåœ¨å¯¹åº”ç›®å½•æ‰§è¡Œï¼‰
cd backend
npm config set registry https://registry.npmmirror.com

cd frontend-admin
npm config set registry https://registry.npmmirror.com

cd frontend-h5
npm config set registry https://registry.npmmirror.com
```

### é”™è¯¯4ï¼špnpm-lock.yaml é—®é¢˜

```
ERR_PNPM_NO_LOCKFILE
```

**è§£å†³æ–¹æ³•**ï¼š
å·²åœ¨ Dockerfile ä¸­ä½¿ç”¨ `--no-frozen-lockfile` å‚æ•°ï¼Œæ— éœ€ lockfile

## ğŸ¯ å¿«é€Ÿè§£å†³æ–¹æ¡ˆæ€»ç»“

1. âœ… **å·²ä¿®å¤ vue-tsc é”™è¯¯** - ä¿®æ”¹äº† package.json
2. âœ… **å·²åˆ›å»ºæ¸…ç†è„šæœ¬** - ä½¿ç”¨ rebuild.bat
3. âœ… **å·²ä¼˜åŒ– Dockerfile** - ä½¿ç”¨ `--no-frozen-lockfile`

## ğŸš€ ç°åœ¨å¯ä»¥è¿è¡Œ

```batch
# æ¸…ç†å¹¶é‡æ–°æ„å»º
rebuild.bat

# æˆ–ä½¿ç”¨åŸæ¥çš„å¯åŠ¨è„šæœ¬
start-clean.bat
```

## ğŸ“Š é¢„æœŸæ„å»ºæ—¶é—´

| æœåŠ¡ | é¦–æ¬¡æ„å»ºæ—¶é—´ |
|------|-------------|
| MySQL | 1-2 åˆ†é’Ÿ |
| Redis | 30 ç§’ |
| Backend | 3-5 åˆ†é’Ÿ |
| Frontend Admin | 2-3 åˆ†é’Ÿ |
| Frontend H5 | 2-3 åˆ†é’Ÿ |
| **æ€»è®¡** | **çº¦ 10-15 åˆ†é’Ÿ** |

## âœ… æ„å»ºæˆåŠŸæ ‡å¿—

æŸ¥çœ‹æ—¥å¿—åº”è¯¥çœ‹åˆ°ï¼š

```
âœ” Container score-system-mysql          Started
âœ” Container score-system-redis          Started
âœ” Container score-system-backend        Started
âœ” Container score-system-admin          Started
âœ” Container score-system-h5             Started
```

## ğŸ†˜ ä»ç„¶å¤±è´¥ï¼Ÿ

1. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**ï¼š
   ```batch
   docker-compose logs -f
   ```

2. **å®Œå…¨æ¸…ç†å¹¶é‡è¯•**ï¼š
   ```batch
   docker-compose down -v
   docker system prune -a --volumes
   rebuild.bat
   ```

3. **æ£€æŸ¥ç£ç›˜ç©ºé—´**ï¼š
   ```batch
   docker system df
   ```

4. **æŸ¥çœ‹é”™è¯¯ä¿¡æ¯**ï¼š
   å¤åˆ¶é”™è¯¯ä¿¡æ¯ï¼ŒæŸ¥çœ‹ä¸Šé¢çš„"å…¶ä»–å¸¸è§æ„å»ºé”™è¯¯"éƒ¨åˆ†

---

**ä¿®å¤å®Œæˆï¼ç°åœ¨å¯ä»¥é‡æ–°æ„å»ºäº†ã€‚** ğŸ‰

