# 🚀 快速配置独立数据库（3分钟）

## 目的
为计分系统创建一个完全独立的数据库 `yunce_score_system`，避免和你现有的Docker项目数据库产生任何冲突。

---

## ⚡ 方法一：自动脚本（最快）

### 第1步：运行数据库创建脚本

**选项A：创建专用用户（推荐）**
```bash
cd score-system/backend
mysql -u root -p < setup-database.sql
```

**选项B：只创建数据库（简单）**
```bash
cd score-system/backend
mysql -u root -p < setup-database-simple.sql
```

### 第2步：配置环境变量

```bash
# 复制环境变量模板
cp .env.独立数据库示例 .env

# 编辑.env文件，根据你选择的方案修改DATABASE_URL
# 如果使用专用用户：DATABASE_URL="mysql://score_user:ScorePass2024!@localhost:3306/yunce_score_system"
# 如果使用root：DATABASE_URL="mysql://root:your_password@localhost:3306/yunce_score_system"
```

### 第3步：初始化数据库

```bash
npx prisma generate
npx prisma migrate dev --name init
npx prisma db seed
```

### 第4步：启动服务

```bash
pnpm start:dev
```

✅ **完成！** 访问 http://localhost:3000/api-docs

---

## 📝 方法二：手动执行（推荐理解流程）

### 第1步：连接MySQL

```bash
mysql -u root -p
```

### 第2步：创建独立数据库

```sql
-- 创建数据库（名称明确，不会和其他项目冲突）
CREATE DATABASE yunce_score_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 查看所有数据库（确认创建成功）
SHOW DATABASES;

-- 你应该看到：
-- your_docker_project_db  <- 你的Docker项目数据库
-- yunce_score_system      <- 新的计分系统数据库（完全独立）

-- 退出
EXIT;
```

### 第3步：配置环境变量

编辑 `backend/.env` 文件：

```env
# 使用独立数据库
DATABASE_URL="mysql://root:your_password@localhost:3306/yunce_score_system"

# 其他配置
JWT_SECRET="yunce-score-system-secret-2024"
JWT_EXPIRES_IN="7d"
JWT_ADMIN_EXPIRES_IN="12h"
PORT=3000
NODE_ENV="development"
CORS_ORIGIN="http://localhost:5173,http://localhost:5174"
```

### 第4步：初始化

```bash
cd score-system/backend

# 生成Prisma Client
npx prisma generate

# 创建表结构
npx prisma migrate dev --name init

# 导入测试数据
npx prisma db seed
```

### 第5步：验证

```bash
# 连接到新数据库查看表
mysql -u root -p yunce_score_system -e "SHOW TABLES;"

# 应该看到8张表：
# admins, admin_logs, bets, bet_settings, 
# lottery_results, point_records, system_settings, users
```

### 第6步：启动服务

```bash
pnpm install  # 如果还没安装依赖
pnpm start:dev
```

---

## ✅ 验证独立性

### 检查1：数据库列表

```bash
mysql -u root -p -e "SHOW DATABASES;"
```

确认看到：
```
+----------------------+
| Database             |
+----------------------+
| your_docker_db       |  ← 你的旧项目
| yunce_score_system   |  ← 新项目（完全独立）
+----------------------+
```

### 检查2：表结构

```bash
mysql -u root -p yunce_score_system -e "SHOW TABLES;"
```

确认看到8张表：
```
+-------------------------------+
| Tables_in_yunce_score_system  |
+-------------------------------+
| admins                        |
| admin_logs                    |
| bets                          |
| bet_settings                  |
| lottery_results               |
| point_records                 |
| system_settings               |
| users                         |
+-------------------------------+
```

### 检查3：测试用户

```bash
mysql -u root -p yunce_score_system -e "SELECT id, username, points FROM users;"
```

应该看到测试用户：
```
+----+----------+--------+
| id | username | points |
+----+----------+--------+
|  1 | user001  |   5000 |
|  2 | user002  |   3000 |
+----+----------+--------+
```

---

## 🎯 配置对比

### 你的Docker项目
```
数据库名称：your_docker_db
端口：3306（或其他）
项目：独立运行
```

### 新的计分系统
```
数据库名称：yunce_score_system  ← 完全不同
端口：3306（共享MySQL实例，但数据库独立）
后端端口：3000（可调整）
项目：独立运行
```

**✅ 两个项目完全独立，互不影响！**

---

## 🔄 如果需要重置数据

### 方法1：Prisma重置（推荐）

```bash
cd score-system/backend

# 重置数据库（删除所有数据和表）
npx prisma migrate reset

# 会自动重新创建表和种子数据
```

### 方法2：手动删除

```bash
# 删除数据库
mysql -u root -p -e "DROP DATABASE yunce_score_system;"

# 重新创建
mysql -u root -p < setup-database-simple.sql

# 重新初始化
cd score-system/backend
npx prisma migrate dev --name init
npx prisma db seed
```

---

## 📊 数据库说明

### 数据库名称选择
- ✅ `yunce_score_system` - 推荐（明确，不会混淆）
- ✅ `score_system_new` - 备选
- ❌ `score_system` - 不推荐（太通用）

### 为什么选择 `yunce_score_system`？
1. ✅ 名称明确，一看就知道是云策计分系统
2. ✅ 不会和其他项目冲突
3. ✅ 便于管理和识别
4. ✅ 备份时易于区分

---

## 🔒 安全建议

### 1. 使用专用数据库用户（推荐）

```sql
-- 创建专用用户
CREATE USER 'score_user'@'localhost' IDENTIFIED BY 'StrongPassword2024!';

-- 只授予这个数据库的权限
GRANT ALL PRIVILEGES ON yunce_score_system.* TO 'score_user'@'localhost';

-- 刷新权限
FLUSH PRIVILEGES;
```

然后在 `.env` 中使用：
```env
DATABASE_URL="mysql://score_user:StrongPassword2024!@localhost:3306/yunce_score_system"
```

### 2. 定期备份

```bash
# 备份数据库
mysqldump -u root -p yunce_score_system > backup_$(date +%Y%m%d).sql

# 恢复数据库
mysql -u root -p yunce_score_system < backup_20241126.sql
```

---

## ❓ 常见问题

### Q: 会影响我的Docker项目吗？
**A:** 不会！使用完全不同的数据库名称，互不干扰。

### Q: 可以同时运行两个项目吗？
**A:** 可以！只要后端API使用不同的端口。

### Q: 如何切换回开发环境？
**A:** 只需要修改 `.env` 中的 `DATABASE_URL`。

### Q: 如何彻底删除计分系统数据？
**A:** 
```sql
DROP DATABASE yunce_score_system;
```

---

## 📞 需要帮助？

如果遇到问题，检查：
1. MySQL服务是否启动
2. 数据库名称是否正确
3. 用户名密码是否正确
4. 端口是否被占用

查看详细文档：[独立数据库配置指南.md](backend/独立数据库配置指南.md)

---

**✅ 配置完成后，你将拥有：**
- 独立的数据库 `yunce_score_system`
- 不影响其他项目
- 可以随时删除重建
- 数据完全隔离

**🚀 开始使用吧！**



