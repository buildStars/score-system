# 组合下注规则（反向逻辑）🔄

## 📋 核心理念

### 反向对赌机制

**关键**：组合下注的积分变动与开奖结果**反向**。

```
用户下注"大单" = 用户赌"不是大单"

开奖≠下注（如小单/小双/大双）→ 用户赢钱 ✅
开奖=下注（如大单）→ 用户输钱或打平 ❌
```

---

## 🎯 三种结算情况

### 情况1：没中奖（开奖≠下注）→ 用户赢钱

**条件**：开奖结果与下注选择不匹配

**计算公式**：
```
最终积分 = 原积分 + 下注金额 - 手续费
```

**例子**：
```
账户：1000分
下注：100大单
开奖：小单/小双/大双（不是大单）
手续费：100 / 100 × 5 = 5

计算：1000 + 100 - 5 = 1095
盈亏：+95
```

---

### 情况2：中奖且回本（开奖=下注 且 回本）→ 不输不赢

**条件**：
1. 开奖结果与下注选择匹配
2. 符合回本条件（对子/豹子/顺子/总和13或14）

**计算公式**：
```
最终积分 = 原积分 + 0 - 手续费
```

**例子**：
```
账户：2000分
下注：100大双
开奖：3+3+8 = 14（大双且回本）
手续费：100 / 100 × 5 = 5

计算：2000 + 0 - 5 = 1995
盈亏：-5（只亏手续费）
```

---

### 情况3：中奖且不回本（开奖=下注 且 不回本）→ 用户输钱

**条件**：
1. 开奖结果与下注选择匹配
2. 不符合回本条件

**计算公式**：
```
损失金额 = 下注金额 × 5
最终积分 = 原积分 - 损失金额 - 手续费
```

**例子**：
```
账户：2000分
下注：100大双
开奖：8+9+3 = 20（大双且不回本）
损失：100 × 5 = 500
手续费：100 / 100 × 5 = 5

计算：2000 - 500 - 5 = 1495
盈亏：-505（输5倍本金+手续费）
```

---

## 📊 手续费说明

### 计算公式

```
手续费 = (下注金额 / 100) × 5
```

### 例子

| 下注金额 | 手续费 |
|---------|--------|
| 100 | 5 |
| 500 | 25 |
| 1000 | 50 |
| 2000 | 100 |

### 重要

**无论输赢，手续费都要扣除！**

---

## 🎲 完整例子

### 例子1：下注大单，开奖小单（没中奖）

```
用户信息：
- 账户：1000分
- 下注：100大单

开奖结果：
- 号码：1+3+5 = 9
- 大小：小（9 < 14）
- 单双：单（9是奇数）
- 组合：小单
- 判定：没中奖 ❌（下注大单，开奖小单）

计算过程：
手续费 = 100 / 100 × 5 = 5
最终积分 = 1000 + 100 - 5 = 1095

最终积分：1095
盈亏：+95（赢本金扣手续费）✅
```

---

### 例子2：下注大双，开奖大双且不回本（中奖）

```
用户信息：
- 账户：2000分
- 下注：100大双

开奖结果：
- 号码：8+9+3 = 20
- 大小：大（20 >= 14）
- 单双：双（20是偶数）
- 组合：大双
- 回本判定：不回本 ❌
  └─ 没有对子/豹子
  └─ 不是顺子
  └─ 总和20≠13且≠14
- 判定：中奖且不回本（下注大双，开奖大双，不回本）

计算过程：
损失金额 = 100 × 5 = 500
手续费 = 100 / 100 × 5 = 5
最终积分 = 2000 - 500 - 5 = 1495

最终积分：1495
盈亏：-505（输5倍本金+手续费）❌
```

---

### 例子3：下注大双，开奖大双且回本（中奖）

```
用户信息：
- 账户：2000分
- 下注：100大双

开奖结果：
- 号码：3+3+8 = 14
- 大小：大（14 >= 14）
- 单双：双（14是偶数）
- 组合：大双
- 回本判定：回本 ✅
  └─ 有对子：3+3
- 判定：中奖且回本（下注大双，开奖大双，回本）

计算过程：
手续费 = 100 / 100 × 5 = 5
最终积分 = 2000 + 0 - 5 = 1995

最终积分：1995
盈亏：-5（只亏手续费）
```

---

### 例子4：下注小双，开奖大单（没中奖）

```
用户信息：
- 账户：3000分
- 下注：200小双

开奖结果：
- 号码：7+8+10 = 25
- 大小：大（25 >= 14）
- 单双：单（25是奇数）
- 组合：大单
- 判定：没中奖 ❌（下注小双，开奖大单）

计算过程：
手续费 = 200 / 100 × 5 = 10
最终积分 = 3000 + 200 - 10 = 3190

最终积分：3190
盈亏：+190（赢本金扣手续费）✅
```

---

## 🔄 与倍数下注的对比

| 特性 | 倍数下注 | 组合下注 |
|-----|---------|---------|
| **手续费** | 每100为3 | **每100为5** |
| **回本逻辑** | 同样判断 | **同样判断** |
| **输赢方向** | 正常 | **反向** |
| **回本时** | 不输不赢，扣手续费 | **同样** |
| **不回本时** | 输80%本金+手续费 | **输5倍本金+手续费** |

### 关键区别

1. **手续费更高**：5% vs 3%
2. **输赢反向**：没中奖反而赢钱
3. **风险更大**：不回本时输5倍而不是0.8倍

---

## 📈 结算流程图

```
用户下注
    ↓
开奖
    ↓
判断：开奖 = 下注？
    ├─ NO → 没中奖
    │   └─ +本金 - 手续费 ✅ 赢钱
    │
    └─ YES → 中奖
        ↓
        判断：回本？
        ├─ YES → 回本
        │   └─ +0 - 手续费（只亏手续费）
        │
        └─ NO → 不回本
            └─ -本金×5 - 手续费 ❌ 输钱
```

---

## 💻 判定代码示例

```typescript
function calculateComboResult(
  userBetCombo: string,     // 用户下注：'大单'/'小双'/等
  drawCombo: string,        // 开奖组合：'大单'/'小双'/等
  isReturn: boolean,        // 是否回本
  betAmount: number         // 下注金额
): {
  result: 'win' | 'loss' | 'return',
  pointChange: number,      // 积分变化
  fee: number               // 手续费
} {
  // 计算手续费
  const fee = (betAmount / 100) * 5;
  
  // 情况1：没中奖（开奖≠下注）→ 用户赢
  if (userBetCombo !== drawCombo) {
    return {
      result: 'win',
      pointChange: betAmount - fee,  // +本金 - 手续费
      fee
    };
  }
  
  // 情况2：中奖且回本 → 不输不赢
  if (isReturn) {
    return {
      result: 'return',
      pointChange: -fee,  // 只扣手续费
      fee
    };
  }
  
  // 情况3：中奖且不回本 → 用户输
  return {
    result: 'loss',
    pointChange: -(betAmount * 5) - fee,  // -5倍本金 - 手续费
    fee
  };
}
```

---

## ⚠️ 重要提示

### 1. 反向逻辑

这是一个**对赌**系统：
- 用户下注"大单"实际是赌"不是大单"
- 没中奖反而赢钱
- 中奖反而输钱（除非回本）

### 2. 手续费必扣

无论输赢，手续费都要扣除！

### 3. 风险巨大

中奖且不回本时，输**5倍本金**！

---

## 🎉 总结

### 核心规则

✅ 积分变动与开奖结果**反向**  
✅ 手续费**必扣**（每100为5）  
✅ 判断**回本不回本**（与倍数下注逻辑相同）  
✅ 三种情况：没中赢钱、中奖回本打平、中奖不回本输5倍

### 计算公式

| 情况 | 公式 |
|-----|------|
| 没中奖 | `+本金 - 手续费` |
| 中奖且回本 | `+0 - 手续费` |
| 中奖且不回本 | `-本金×5 - 手续费` |

**这就是组合下注的反向对赌逻辑！** 🔄



