# ✅ 模式设置功能 - 测试指南

## 🎉 数据库迁移已完成

### 已完成的工作
- ✅ 创建了 `bet_type_settings` 表
- ✅ 插入了 12 条默认配置
- ✅ Prisma Client 已生成
- ✅ 后端代码已部署
- ✅ 前端页面已创建

---

## 🚀 测试步骤

### 第1步：重启后端服务

```bash
cd score-system/backend
# 按 Ctrl+C 停止当前服务
npm run start:dev
```

**检查日志：**
```
[Nest] INFO Nest application successfully started ✅
```

---

### 第2步：测试API接口

#### 测试1：获取所有配置
```
GET http://localhost:3000/api/admin/bet-type-settings
```

打开浏览器访问或使用 Postman：
```
http://localhost:3000/api/admin/bet-type-settings
```

**预期响应：**
```json
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "betType": "single",
      "name": "单",
      "odds": 1.95,
      "minBet": 1.00,
      "maxBet": 4999.00,
      "feeRate": 0.0000,
      "rebateRate": 0.0000,
      "isEnabled": true,
      "sortOrder": 1,
      "description": "结果为单数"
    },
    // ... 其他11条
  ]
}
```

#### 测试2：更新单个配置
```
PUT http://localhost:3000/api/admin/bet-type-settings/single
Content-Type: application/json
Authorization: Bearer YOUR_TOKEN

{
  "minBet": 2.00,
  "maxBet": 5000.00
}
```

**预期响应：**
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "betType": "single",
    "minBet": 2.00,
    "maxBet": 5000.00,
    ...
  }
}
```

---

### 第3步：访问前端页面

1. **打开浏览器**
   ```
   http://localhost:5173
   ```

2. **登录后台管理系统**
   - 用户名：admin
   - 密码：（你的密码）

3. **进入"模式设置"菜单**
   - 点击左侧菜单的"模式设置"

4. **预期效果**
   - 看到配置列表表格
   - 可以编辑每一项
   - 可以保存配置

---

## 🧪 功能测试清单

### 测试1：页面加载 ✅
- [ ] 页面正常打开
- [ ] 显示12条配置数据
- [ ] 数据格式正确

### 测试2：编辑配置 ✅
- [ ] 可以修改赔率
- [ ] 可以修改最小投注额
- [ ] 可以修改最大投注额
- [ ] 可以修改手续费
- [ ] 可以修改退水比例
- [ ] 可以切换启用状态

### 测试3：保存配置 ✅
- [ ] 点击"保存配置"按钮
- [ ] 显示确认对话框
- [ ] 保存成功提示
- [ ] 页面数据刷新

### 测试4：重置单项 ✅
- [ ] 修改某项配置
- [ ] 点击"重置"按钮
- [ ] 恢复到原始值

### 测试5：数据验证 ✅
- [ ] 最小值 > 最大值时提示错误
- [ ] 费率超出0-100提示错误
- [ ] 保存后后端日志记录操作

---

## 🎨 页面效果

### 正常状态
```
┌─────────────────────────────────────────────────────────────────┐
│  下注类型配置 - 模式设置                      [保存配置]         │
├─────────────────────────────────────────────────────────────────┤
│ 说明：配置每种下注类型的赔率、投注限额、手续费和退水比例       │
├─────────────────────────────────────────────────────────────────┤
│ 模式 │ 赔率  │ 专线  │ 最小  │ 最大   │ 手续费% │ 退水% │ 启用 │  │
├─────────────────────────────────────────────────────────────────┤
│ 单   │ [1.95]│ [1.00]│ [1.00]│ [4999] │ [0.00]  │ [0.00]│ [✓]  │🔄│
│ 双   │ [1.95]│ [1.00]│ [1.00]│ [4999] │ [0.00]  │ [0.00]│ [✓]  │🔄│
│ ...                                                              │
└─────────────────────────────────────────────────────────────────┘

💡 配置说明：
• 赔率：中奖时的赔付倍数（如1.95表示投100赢195）
• 专线/最小/最大：单次投注的金额限制
• 手续费：下注时扣除的费用比例（如3%表示投100扣3元）
• 退水：返还给用户的比例，类似佣金（如2%表示投100返2元）
• 启用状态：关闭后用户无法选择此玩法
```

### 编辑状态
```
点击数字框即可编辑 → 输入新值 → 点击保存
```

---

## 🔍 API 测试（可选）

如果想直接测试API，可以使用以下命令：

### Windows PowerShell
```powershell
# 获取配置（需要先登录获取 token）
$headers = @{
    "Authorization" = "Bearer YOUR_TOKEN_HERE"
}

Invoke-RestMethod -Uri "http://localhost:3000/api/admin/bet-type-settings" `
    -Headers $headers `
    -Method Get
```

### 或在浏览器控制台
```javascript
// 登录后，在浏览器控制台执行
fetch('http://localhost:3000/api/admin/bet-type-settings', {
  headers: {
    'Authorization': 'Bearer ' + localStorage.getItem('token')
  }
})
.then(res => res.json())
.then(data => console.table(data.data))
```

---

## 🐛 问题排查

### 问题1：API返回404
**错误：** `Cannot GET /api/admin/bet-type-settings`

**解决：**
```bash
# 重启后端服务
cd score-system/backend
# Ctrl+C 停止
npm run start:dev
```

### 问题2：前端页面空白
**错误：** 页面打开但没有数据

**检查：**
1. 打开浏览器控制台（F12）
2. 查看 Network 标签
3. 检查API请求是否成功

### 问题3：保存失败
**错误：** 点击保存没反应或报错

**检查：**
1. 浏览器控制台是否有错误
2. 是否已登录
3. Token 是否有效

---

## 📊 验证数据

### 已插入的默认数据

**单/双/大/小（基础玩法）**
- 赔率：1.95
- 限额：1-4999
- 手续费：0%
- 退水：0%

**大单/大双/小单/小双（组合玩法）**
- 赔率：3.80
- 限额：0-1000（小双最小为0，大双最小为19.5）
- 手续费：0%
- 退水：0%

**倍数玩法（2/3/5/10倍）**
- 赔率：对应倍数（2.00, 3.00, 5.00, 10.00）
- 限额：1-4999
- **手续费：3%** ⚠️
- 退水：0%

---

## 🎯 下一步操作

1. **重启后端服务** ⏰
   ```bash
   cd score-system/backend
   # Ctrl+C 停止当前服务
   npm run start:dev
   ```

2. **刷新前端浏览器** ⏰
   ```
   按 Ctrl + Shift + R 强制刷新
   ```

3. **进入模式设置页面** ⏰
   ```
   登录 → 点击左侧菜单"模式设置"
   ```

4. **测试功能** ⏰
   - 修改某项配置
   - 点击保存
   - 查看是否生效

---

**🎊 数据库迁移完成！现在可以重启后端服务了！** 

```bash
cd score-system/backend
npm run start:dev
```

重启后，前端"模式设置"菜单就可以使用了！🚀


